var brfPhoneGapApp=angular.module("brfPhoneGapApp",["ngRoute"]),db,app={initialize:function(){this.bindEvents(),db=window.openDatabase("BRF","1.0","BRF",2e5)},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){app.receivedEvent("deviceready")},receivedEvent:function(e){var t=document.getElementById(e),n=t.querySelector(".listening"),o=t.querySelector(".received");n.setAttribute("style","display:none;"),o.setAttribute("style","display:block;"),console.log("Received Event: "+e)}};brfPhoneGapApp.config(["$routeProvider",function(e){e.when("/Main",{templateUrl:"app/views/main.html",controller:"MainController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/Dashboard",{templateUrl:"app/views/dashboard.html",controller:"dashboardController",access:{isFreeAccess:!1,audit:!1}}).when("/Audit/:auditId",{templateUrl:"app/views/welcome.html",controller:"WelcomeController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/Audit/:auditId/Channel",{templateUrl:"app/views/channels.html",controller:"ChannelsController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/Audit/:auditId/Channel/:channelId/Pdv",{templateUrl:"app/views/form.html",controller:"FormController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/Audit/:auditId/Channel/:channelId/AddPdv",{templateUrl:"app/views/new-pdv.html",controller:"PdvController",access:{isFreeAccess:!1,audit:!1}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller",{templateUrl:"app/views/search.html",controller:"SearchController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/",{templateUrl:"app/views/login.html",controller:"LoginController",controllerAs:"vm",access:{isFreeAccess:!0}}).when("/Synchronizer/:syncModeId",{templateUrl:"app/views/synchronizer.html",controller:"SynchronizerController",access:{isFreeAccess:!1,audit:!1}}).when("/DoSynchronization",{templateUrl:"app/views/doSynchronization.html",controller:"DoSynchronizationController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/SendSynchronization",{templateUrl:"app/views/sendSynchronization.html",controller:"SendSynchronizationController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/SyncOk",{templateUrl:"app/views/syncOk.html",controller:"SyncOkController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/SyncNok",{templateUrl:"app/views/syncNok.html",controller:"SyncNokController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller/:sellerId/observaciones/:default?",{templateUrl:"app/views/observations.html",controller:"ObservationsController",access:{isFreeAccess:!1,audit:!0}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller/:sellerId/no_brf/:default?",{templateUrl:"app/views/noBrf.html",controller:"NoBrfController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!0}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller/:sellerId/Module/:moduleId",{templateUrl:"app/views/questions.html",controller:"QuestionsController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!0}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller/:sellerId/Module/:moduleId/Category/:categoryId/CategoryType/:categoryType",{templateUrl:"app/views/questions.html",controller:"QuestionsController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!0}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller/:sellerId/:slug/:default?",{templateUrl:"app/views/categorySearch.html",controller:"CategoryController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!0}}).otherwise({redirectTo:"/"})}]).run(function(e,t,n,o,r){r.init(),e.$on("$viewContentLoaded",function(e){$(".collapsible").collapsible(),$("select").material_select()}),e.$on("$routeChangeStart",function(e,r){void 0!=r.access&&(r.access.isFreeAccess||n.authenticated()||t.path("/")),void 0!=r.access?!r.access.audit&&o.getAuditMode()&&t.path("/Audit/"+o.getAuditId()+"/Channel/"+o.getAuditChannel()+"/Pdv/"+o.getAuditPdv()+"/Seller/"+o.getAuditSeller()+"/coaching_sp/defaultModule"):t.path("/Main")})}),function(){"use strict";function e(e,t,n,o,r,a){function u(){"defaultModule"===i.routeParams["default"]&&(console.log("defaultModuleLoaded"),o.$emit("defaultModuleLoaded")),r.getModuleBySlug(i.routeParams.slug).then(function(t){i.currentModule=t,n.getCategories(t.categoryType,i.routeParams.channelId).then(function(n){n.length>0?e.categories=n:a.path("/Audit/"+i.routeParams.auditId+"/Channel/"+i.routeParams.channelId+"/Pdv/"+i.routeParams.pdvId+"/Seller/"+i.routeParams.sellerId+"/Module/"+t.moduleId)})})}var i=this;i.routeParams=t,i.currentModule,u()}angular.module("brfPhoneGapApp").controller("CategoryController",e),e.$inject=["$scope","$routeParams","Category","$rootScope","Module","$location"]}(),function(){"use strict";function e(e,t,n,o,r){function a(){o.getChannels().then(function(e){u.channels=e,u.lastChannelId=null===r.getLastAuditChannel()?void 0:r.getLastAuditChannel(),u.auditId=n.auditId})}var u=this;u.channels=[],u.lastChannelId,u.auditId,a()}angular.module("brfPhoneGapApp").controller("ChannelsController",e),e.$inject=["$scope","$route","$routeParams","Channel","Survey"]}(),function(){"use strict";function e(e,t,n,o,r,a,u){function i(){s.routeParams=n,a.getModuleByName("Coaching Supervisor").then(function(t){console.log("Emit Default Module Loaded Event"),u.$emit("defaultModuleLoaded"),r.getPendingSurvey().then(function(n){void 0!==n?o.getQuestions(t.moduleId,n.id,void 0,t.categoryType).then(function(t){e.questions=t}):o.getQuestions(t.moduleId,0,void 0,t.categoryType).then(function(t){e.questions=t})})})}var s=this;s.routeParams,i()}angular.module("brfPhoneGapApp").controller("CoachingController",e),e.$inject=["$scope","$route","$routeParams","Question","Survey","Module","$rootScope"]}(),function(){"use strict";function e(e,t,n,o,r,a,u,i,s,c,l,d){function f(){e.syncChannels=0,e.syncCustomers=0,e.syncCustomersType=0,e.syncSellers=0,e.syncMainModules=0,e.syncModules=0,e.syncCategories=0,e.syncCategoriesImg=0,e.syncQuestions=0,e.syncImages=0,l.dropAll().then(function(){l.init();var t=n.defer();return e.syncChannels=1,a.synchronizeChannels().then(function(o){var r=[];angular.forEach(o.data.channels,function(e,t){r.push(a.setChannel(e.id,e.name))}),n.all(r).then(function(){e.syncChannels=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncCustomers=1,u.synchronizeCustomers().then(function(o){var r=[];angular.forEach(o.data.customers,function(e,t){r.push(u.setCustomer(e.id,e.company_name,e.cuit,e.address,e.type_pdv))}),n.all(r).then(function(){e.syncCustomers=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncCustomersType=1,u.synchronizeCustomerTypes().then(function(o){var r=[];angular.forEach(o.data.customer_types,function(e,t){r.push(u.setCustomerType(e.id,e.name))}),n.all(r).then(function(){e.syncCustomersType=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncSellers=1,c.synchronizeSellers().then(function(o){var r=[];angular.forEach(o.data.sellers,function(e,t){r.push(c.setSeller(e.id,e.name))}),n.all(r).then(function(){e.syncSellers=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncMainModules=1,i.synchronizeMainModules().then(function(o){var r=[];angular.forEach(o.data.main_modules,function(e,t){r.push(i.setMainModule(e.id,e.mod_name,e.icon,e.map_label,e.has_dashboard))}),n.all(r).then(function(){e.syncMainModules=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncModules=1,i.synchronizeModules().then(function(o){var r=[];angular.forEach(o.data.modules,function(e,t){var n=e.id;r.push(i.setModule(e.id,e.behavior,e.mod_name,e.category_type,e.style.color,e.style.icon,e.slug,e.id_main_mod)),angular.forEach(e.ids_channels,function(e,t){r.push(i.setModuleChannels(n,e))}),angular.forEach(e.ids_user_roles,function(e,t){r.push(i.setModuleRoles(n,e))})}),n.all(r).then(function(){e.syncModules=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(t){var o=n.defer();return e.syncCategories=1,r.synchronizeCategories().then(function(t){var a=[];angular.forEach(t.data.categories,function(e,t){var n=e.id;a.push(r.setCategory(e.id,e.type,e.name)),angular.forEach(e.id_channels,function(e,t){a.push(r.setCategoryChannel(n,e))})}),n.all(a).then(function(){e.syncCategories=2,o.resolve()})})["catch"](function(e){o.reject(e)}),o.promise}).then(function(){var t=n.defer();return e.syncCategoriesImg=1,r.synchronizeCategoryImages().then(function(o){var a=[];angular.forEach(o.data.categories_images,function(e,t){a.push(r.setCategoryImage(e.id,e.id_mod,e.id_cat,void 0===y.devicePath?e.image:cordova.file.externalApplicationStorageDirectory+"BRF/Images/"+e.image.split("/").pop(),e.icon))}),n.all(a).then(function(){e.syncCategoriesImg=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncQuestions=1,s.synchronizeQuestions().then(function(o){var r=[];angular.forEach(o.data.questions,function(e,t){var n=e.id;r.push(s.setQuestion({questionId:e.id,categoryId:e.id_category,render:e.render,answer:e.answer,title:e.title,data:e.data,helper:e.helper,big:void 0===y.devicePath?e.big:cordova.file.externalApplicationStorageDirectory+"BRF/Images/"+e.big.split("/").pop(),thumb:void 0===y.devicePath?e.thumb:cordova.file.externalApplicationStorageDirectory+"BRF/Images/"+e.thumb.split("/").pop(),questionModuleId:e.id_question_mod,config:"object"==typeof e.config?JSON.stringify(e.config):e.config,styling:"object"==typeof e.styling?JSON.stringify(e.styling):e.styling})),angular.forEach(e.pdv_filter,function(e,t){r.push(s.setQuestionPdv(n,e))})}),n.all(r).then(function(){e.syncQuestions=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();if(e.syncImages=1,void 0===y.devicePath)return e.syncImages=2,void t.resolve();new FileTransfer;return d.getAllImages().then(function(o){var r=[],a=function(e){var t=n.defer();return window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(n){var o=new FileTransfer;o.download(encodeURI(e),cordova.file.externalApplicationStorageDirectory+"BRF/Images/"+e.split("/").pop(),function(n){console.log("Success:"+e.split("/").pop()),t.resolve()},function(n){console.log("Error: "+e.split("/").pop()),t.reject(n)})}),t.promise};angular.forEach(o.data.images,function(e,t){console.log(e),void 0!==e.thumb&&r.push(a(e.thumb)),void 0!==e.big&&r.push(a(e.big))}),n.all(r).then(function(){e.syncImages=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){o.path("/SyncOk")})["catch"](function(e){console.log(e),o.path("/SyncNok")})}var y=this;y.devicePath=void 0,navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/)&&(y.devicePath=cordova.file.externalApplicationStorageDirectory),f()}angular.module("brfPhoneGapApp").controller("DoSynchronizationController",e),e.$inject=["$scope","$route","$q","$location","Category","Channel","Customer","Module","Question","Seller","Database","Image"]}(),function(){"use strict";function e(e,t,n,o,r,a){function u(){r.getModuleByName("Ejecución PDV").then(function(t){a.getPendingSurvey().then(function(r){void 0!==n.categoryId?o.getQuestions(t.moduleId,r.id,n.categoryId).then(function(t){e.questions=t}):o.getQuestions(t.moduleId,r.id,void 0,t.categoryType).then(function(t){e.questions=t})})})}u()}angular.module("brfPhoneGapApp").controller("ExecutionController",e),e.$inject=["$scope","$route","$routeParams","Question","Module","Survey"]}(),function(){"use strict";function e(e,t,n,o,r){function a(){e.channelId=n.channelId,o.getCustomers().then(function(e){u.customers=e,u.lastPdvId=null===r.getLastAuditPdv()?void 0:r.getLastAuditPdv(),u.auditId=n.auditId})}var u=this;e.channelId,u.customers=[],u.lastPdvId,u.auditId,a()}angular.module("brfPhoneGapApp").controller("FormController",e),e.$inject=["$scope","$route","$routeParams","Customer","Survey"]}(),function(){"use strict";function e(e,t){function n(){}n()}angular.module("brfPhoneGapApp").controller("MainController",e),e.$inject=["$scope","$route"]}(),function(){"use strict";function e(e,t,n,o,r,a,u,i,s){function c(){o.authenticated()&&n.path("/Main"),l.loggedUserName=l.getUserName(),l.routeParams=a,i.getMainModules().then(function(e){l.mainModules=e})}var l=this;l.username,l.password,l.routeParams,l.loggedUserName,l.mainModules=[];var d=function(){i.getModules(r.getAuditChannel(),o.getToken().id_role,r.getAuditId()).then(function(t){e.modules=t})},f=function(){o.validateUser(l.username,l.password).then(function(e){"string"==typeof e.data?"false"===e.data.trim()&&(l.username="",l.password=""):"object"==typeof e.data&&(o.authenticate(e.data),n.path("/Main"))})},y=function(){o.authenticate(void 0),n.path("/")},m=function(){if(!o.authenticated())return"";var e=o.getToken();return e.name};u.$on("defaultModuleLoaded",function(e,t){r.getPendingSurvey().then(function(e){void 0===e?s.getPdvTypeByCustomerId(l.routeParams.pdvId).then(function(e){r.setSurvey((new Date).getTime().toString(),l.routeParams.channelId,e.pdvType,l.routeParams.sellerId,o.getToken().id).then(function(){r.enableAuditMode(a.channelId,a.pdvId,a.sellerId,a.auditId),l.loadModules()})}):l.loadModules()})}),e.authenticated=function(){return o.authenticated()},e.isAuditModeEnabled=function(){return r.getAuditMode()},l.loadModules=d,l.login=f,l.logout=y,l.getUserName=m,c()}angular.module("brfPhoneGapApp").controller("LoginController",e),e.$inject=["$scope","$route","$location","Login","Survey","$routeParams","$rootScope","Module","Customer"]}(),function(){"use strict";function e(e,t){function n(){t.getPendingSurvey().then(function(n){t.getNoBrf(n.id).then(function(t){void 0===t?e.noBrfStatus=!1:e.noBrfStatus="true"===t.noBrf})}),e.noBrfChanged=function(){t.getPendingSurvey().then(function(n){t.setNoBrf(n.id,e.noBrfStatus).then(function(){})})}}n()}angular.module("brfPhoneGapApp").controller("NoBrfController",e),e.$inject=["$scope","Survey"]}(),function(){"use strict";function e(e,t){function n(){t.getPendingSurvey().then(function(n){t.getObservations(n.id).then(function(t){void 0===t?e.observations="":e.observations=t.observations})}),e.observationsChanged=function(){t.getPendingSurvey().then(function(n){t.setObservations(n.id,e.observations).then(function(){})})}}e.observations,n()}angular.module("brfPhoneGapApp").controller("ObservationsController",e),e.$inject=["$scope","Survey"]}(),function(){"use strict";function e(e,t,n,o,r,a){function u(){r.getCustomerTypes().then(function(t){e.customerTypes=t,e.selectedCustomerType=e.customerTypes[0]}),i.lastPdvId=null===a.getLastAuditPdv()?void 0:a.getLastAuditPdv()}var i=this;i.lastPdvId,e.customerTypes=[],e.companyName,e.identifier,e.address;var s=function(){r.setCustomer(0,e.companyName,e.identifier,e.address,e.selectedCustomerType.id).then(function(){n.path("Channel/"+o.channelId+"/Pdv/0/Seller")})};i.addPdv=s,u()}angular.module("brfPhoneGapApp").controller("PdvController",e),e.$inject=["$scope","$route","$location","$routeParams","Customer","Survey"]}(),function(){"use strict";function e(e,t,n,o,r){function a(){o.getModuleByName("Toma de Precios").then(function(o){r.getPendingSurvey().then(function(r){n.getQuestions(o.moduleId,r.id,t.categoryId,o.categoryType).then(function(t){e.questions=t})})})}a()}angular.module("brfPhoneGapApp").controller("PricesController",e),e.$inject=["$scope","$routeParams","Question","Module","Survey"]}(),function(){"use strict";function e(e,t,n,o,r,a){function u(){void 0!==n.categoryId?t.getPendingSurvey().then(function(t){r.getCategoryById(n.categoryId).then(function(e){i.currentCategory=e}),a.getModuleById(n.moduleId).then(function(e){i.currentModule=e}),o.getQuestions(n.moduleId,t.id,n.categoryId,n.categoryType).then(function(t){e.questions=t})}):a.getModuleById(n.moduleId).then(function(r){i.currentModule=r,t.getPendingSurvey().then(function(t){void 0!==t?o.getQuestions(r.moduleId,t.id,void 0,r.categoryType).then(function(t){e.questions=t}):o.getQuestions(n.moduleId,0,void 0,r.categoryType).then(function(t){e.questions=t})})})}var i=this;i.currentCategory,i.currentModule,e.questions=[];var s=function(e,n){var o={value:n};t.getPendingSurvey().then(function(n){t.setQuestionAnswer(n.id,e.id,JSON.stringify(o)).then(function(){e.JSONData=o})})},c=function(e){t.getPendingSurvey().then(function(n){t.deleteQuestionAnswer(n.id,e.id).then(function(){e.JSONData=void 0})})},l=function(e){t.getPendingSurvey().then(function(n){t.setQuestionAnswer(n.id,e.id,JSON.stringify(e.JSONData)).then(function(){})})},d=function(e){t.getPendingSurvey().then(function(n){t.setQuestionAnswer(n.id,e.id,JSON.stringify(e.JSONData)).then(function(){})})},f=function(e){t.getPendingSurvey().then(function(n){t.setQuestionAnswer(n.id,e.id,JSON.stringify(e.config.answer_config.selected)).then(function(){})})};e.range=function(e){return new Array(e)},i.binaryAction=s,i.undoBinaryAction=c,i.openAction=l,i.priceAction=d,i.multipleAction=f,u()}angular.module("brfPhoneGapApp").controller("QuestionsController",e),e.$inject=["$scope","Survey","$routeParams","Question","Category","Module"]}(),function(){"use strict";function e(e,t,n,o,r,a,u){function i(){r.getDefaultModules(e.channelId,a.getToken().id_role).then(function(t){e.defaultModuleSlug=t.slug}),o.getSellers().then(function(t){e.sellers=t}),s.lastSellerId=null===u.getLastAuditSeller()?void 0:u.getLastAuditSeller(),s.auditId=n.auditId}var s=this;s.lastSellerId,e.pdvId=n.pdvId,e.channelId=n.channelId,e.defaultModuleSlug,s.auditId,i()}angular.module("brfPhoneGapApp").controller("SearchController",e),e.$inject=["$scope","$route","$routeParams","Seller","Module","Login","Survey"]}(),function(){"use strict";function e(e,t,n,o,r){function a(){t.getClosedSurveys().then(function(n){e.syncSurveys=1;var r=o.defer(),a=[];return angular.forEach(n,function(n,u){a.push(t.informSurvey({data:{main:{id_user:n.userId,survey:n.survey,token:"560a100abad225d5afdf4fc6e5334917"},config:{id_channel:n.channelId,id_type_pdv:n.pdvId,id_seller:n.sellerId},details:{name:"",address:"",notes:""}}}).then(function(){r.resolve()})["catch"](function(e){r.reject(e)})),o.all(a).then(function(){e.syncSurveys=2,r.resolve()})}),r.promise}).then(function(){e.syncNoBrf=1;var n=o.defer(),r=[];return t.getClosedSurveysNoBrf().then(function(a){angular.forEach(a,function(e,n){r.push(t.informNoBrfSurvey({data:{token:"560a100abad225d5afdf4fc6e5334917",id_user:e.userId,survey:e.survey}}))}),o.all(r).then(function(){e.syncNoBrf=2,n.resolve()})}),n.promise}).then(function(){e.syncQuestions=1;var n=o.defer(),a=new Array;return t.getClosedSurveys().then(function(e){console.log(e),angular.forEach(e,function(e,n){r.getQuestionsBySurveyId(e.id).then(function(n){a.push(t.informSurveyQuestions({data:{main:{survey:e.survey,token:"560a100abad225d5afdf4fc6e5334917"},results:{questions:n}}}))})})}),o.all(a).then(function(){e.syncQuestions=2,n.resolve()}),n.promise})["catch"](function(e){console.log(e),n.path("/SyncNok")})}e.syncSurveys=0,e.syncNoBrf=0,e.syncQuestions=0,a()}angular.module("brfPhoneGapApp").controller("SendSynchronizationController",e),e.$inject=["$scope","Survey","$location","$q","Question"]}(),function(){"use strict";function e(e,t,n,o){function r(){}var a=this,u=function(){o.disableAuditMode(),o.closeSurvey().then(function(){n.path("/Welcome")})};r(),a.closeAudit=u}angular.module("brfPhoneGapApp").controller("SurveyController",e),e.$inject=["$scope","$route","$location","Survey"]}(),function(){"use strict";function e(e,t,n){function o(){1===parseInt(e.syncModeId)?n.syncRoute="#/DoSynchronization":n.syncRoute="#/SendSynchronization"}n.syncRoute,o()}angular.module("brfPhoneGapApp").controller("SynchronizerController",e),e.$inject=["$routeParams","$location","$scope"]}(),function(){"use strict";function e(){function e(){}e()}angular.module("brfPhoneGapApp").controller("SyncNokController",e),e.$inject=[]}(),function(){"use strict";function e(){function e(){}e()}angular.module("brfPhoneGapApp").controller("SyncOkController",e),e.$inject=[]}(),function(){"use strict";function e(e){function t(){}var n=this;n.auditId=e.auditId,t()}angular.module("brfPhoneGapApp").controller("WelcomeController",e),e.$inject=["$routeParams"]}(),brfPhoneGapApp.directive("questions",function(){return{restrict:"E",scope:{content:"="},templateUrl:"app/partials/questions.html",replace:!0}}),function(){"use strict";function e(e,t){var n=function(){return e.get("http://ws.brf-horizonte.com/get/categories/?token=560a100abad225d5afdf4fc6e5334917")},o=function(){return e.get("http://ws.brf-horizonte.com/get/categories/images/?token=560a100abad225d5afdf4fc6e5334917")},r=function(e,n,o){return t.query("INSERT INTO Category(categoryId, type, name) VALUES(?, ?, ?)",[e,n,o]).then(function(e){return!0})},a=function(e,n){return t.query("INSERT INTO CategoryChannels(categoryId, channelId) VALUES(?, ?)",[e,n]).then(function(e){return!0})},u=function(e,n,o,r,a){return t.query("INSERT INTO CategoryImage(imageId, idMod, idCat, image, icon) VALUES(?, ?, ?, ?, ?)",[e,n,o,r,a]).then(function(e){return!0})},i=function(e,n){var o="SELECT * FROM Category cat INNER JOIN CategoryChannels catchan ON catchan.categoryId = cat.categoryId WHERE cat.type = ? AND catchan.channelId = ?";return t.query(o,[e,n]).then(function(e){return t.fetchAll(e)})},s=function(e){return t.query("SELECT * FROM Category WHERE CategoryId = ?",[e]).then(function(e){return t.fetch(e)})},c={synchronizeCategories:n,synchronizeCategoryImages:o,setCategory:r,setCategoryChannel:a,setCategoryImage:u,getCategories:i,getCategoryById:s};return c}angular.module("brfPhoneGapApp").factory("Category",e),e.$inject=["$http","Database"]}(),function(){"use strict";function e(e,t){var n=function(){return e.get("http://ws.brf-horizonte.com/get/channels/?token=560a100abad225d5afdf4fc6e5334917")},o=function(e,n){return t.query("INSERT INTO Channel(id, name) VALUES(?, ?)",[e,n]).then(function(e){return!0})},r=function(){return t.query("Select id, name From Channel").then(function(e){return t.fetchAll(e)})},a={synchronizeChannels:n,setChannel:o,getChannels:r};return a}angular.module("brfPhoneGapApp").factory("Channel",e),e.$inject=["$http","Database"]}(),brfPhoneGapApp.factory("Config",function(){var e=this;return e.DB_CONFIG={name:"BRF",tables:[{name:"Category",columns:[{name:"id",type:"integer primary key"},{name:"categoryId",type:"integer"},{name:"type",type:"integer"},{name:"name",type:"text"}]},{name:"CategoryChannels",columns:[{name:"id",type:"integer primary key"},{name:"categoryId",type:"integer"},{name:"channelId",type:"integer"}]},{name:"CategoryImage",columns:[{name:"id",type:"integer primary key"},{name:"imageId",type:"integer"},{name:"idMod",type:"integer"},{name:"idCat",type:"integer"},{name:"image",type:"text"},{name:"icon",type:"text"}]},{name:"Channel",columns:[{name:"id",type:"integer primary key"},{name:"name",type:"text"}]},{name:"Customer",columns:[{name:"id",type:"integer primary key"},{name:"customerId",type:"integer"},{name:"companyName",type:"text"},{name:"cuit",type:"text"},{name:"address",type:"text"},{name:"pdvType",type:"integer"}]},{name:"CustomerType",columns:[{name:"id",type:"integer primary key"},{name:"name",type:"text"}]},{name:"Module",columns:[{name:"id",type:"integer primary key"},{name:"moduleId",type:"integer"},{name:"behavior",type:"text"},{name:"modName",type:"text"},{name:"categoryType",type:"integer"},{name:"color",type:"text"},{name:"icon",type:"text"},{name:"slug",type:"text"},{name:"idMainMod",type:"integer"}]},{name:"ModuleChannels",columns:[{name:"id",type:"integer primary key"},{name:"moduleId",type:"integer"},{name:"channelId",type:"integer"}]},{name:"ModuleUserRoles",columns:[{name:"id",type:"integer primary key"},{name:"moduleId",type:"integer"},{name:"roleId",type:"integer"}]},{name:"Question",columns:[{name:"id",type:"integer primary key"},{name:"questionId",type:"integer"},{name:"categoryId",type:"integer"},{name:"render",type:"text"},{name:"answer",type:"text"},{name:"title",type:"text"},{name:"data",type:"text"},{name:"helper",type:"text"},{name:"big",type:"text"},{name:"thumb",type:"text"},{name:"questionModuleId",type:"integer"},{name:"config",type:"text"},{name:"styling",type:"text"}]},{name:"QuestionPdv",columns:[{name:"id",type:"integer primary key"},{name:"questionId",type:"integer"},{name:"pdvId",type:"integer"}]},{name:"Seller",columns:[{name:"id",type:"integer primary key"},{name:"name",type:"name"}]},{name:"Survey",columns:[{name:"id",type:"integer primary key"},{name:"survey",type:"text"},{name:"syncStatus",type:"integer"},{name:"channelId",type:"integer"},{name:"pdvId",type:"integer"},{name:"sellerId",type:"integer"},{name:"userId",type:"integer"}]},{name:"SurveyNoBrfResults",columns:[{name:"id",type:"integer primary key"},{name:"surveyId",type:"integer"},{name:"noBrf",type:"boolean"}]},{name:"SurveyObservationResults",columns:[{name:"id",type:"integer primary key"},{name:"surveyId",type:"integer"},{name:"observations",type:"text"}]},{name:"SurveyQuestionsResults",columns:[{name:"id",type:"integer primary key"},{name:"surveyId",type:"integer"},{name:"questionId",type:"integer"},{name:"JSONData",type:"text"}]},{name:"MainModule",columns:[{name:"id",type:"integer primary key"},{name:"mod_name",type:"text"},{name:"icon",type:"text"},{name:"map_label",type:"text"},{name:"has_dashboard",type:"integer"}]}]},e}),function(){"use strict";function e(e,t){var n=function(){return e.get("http://ws.brf-horizonte.com/get/customers/?token=560a100abad225d5afdf4fc6e5334917")},o=function(t){return e.get("http://ws.brf-horizonte.com/get/customers/type/?token=560a100abad225d5afdf4fc6e5334917")},r=function(e,n,o,r,a){return t.query("INSERT INTO Customer(customerId, companyName, cuit, address, pdvType) VALUES(?, ?, ?, ?, ?)",[e,n,o,r,a]).then(function(e){return!0})},a=function(e,n){return t.query("INSERT INTO CustomerType(id, name) VALUES(?, ?)",[e,n]).then(function(e){return!0})},u=function(){return t.query("SELECT customerId, address FROM Customer LIMIT 0, 10").then(function(e){return t.fetchAll(e)})},i=function(){return t.query("SELECT id, name FROM CustomerType").then(function(e){return t.fetchAll(e)})},s=function(e){return t.query("SELECT pdvType FROM Customer").then(function(e){return t.fetch(e)})},c={synchronizeCustomers:n,synchronizeCustomerTypes:o,setCustomer:r,setCustomerType:a,getCustomers:u,getCustomerTypes:i,getPdvTypeByCustomerId:s};return c}angular.module("brfPhoneGapApp").factory("Customer",e),e.$inject=["$http","Database"]}(),function(){"use strict";function e(e,t){var n=this;return n.db=null,n.init=function(){n.db=window.openDatabase(t.DB_CONFIG.name,"1.0","database",2e3),angular.forEach(t.DB_CONFIG.tables,function(e){var t=[];angular.forEach(e.columns,function(e){t.push(e.name+" "+e.type)});var o="CREATE TABLE IF NOT EXISTS "+e.name+" ("+t.join(",")+")";n.query(o),console.log("Table "+e.name+" initialized")})},n.dropAll=function(){var o=e.defer(),r=[];return angular.forEach(t.DB_CONFIG.tables,function(t){var a="DROP TABLE IF EXISTS "+t.name;r.push(n.query(a)),console.log("Table "+t.name+" has been drop"),e.all(r).then(function(){o.resolve()})}),o.promise},n.query=function(t,o){o="undefined"!=typeof o?o:[];var r=e.defer();return n.db.transaction(function(e){e.executeSql(t,o,function(e,t){r.resolve(t)},function(e,t){console.log("Database Error:"+t.message),r.reject(t)})}),r.promise},n.fetchAll=function(e){for(var t=[],n=0;n<e.rows.length;n++)t.push(e.rows.item(n));return t},n.fetch=function(e){return e.rows.item(0)},n}angular.module("brfPhoneGapApp").factory("Database",e),e.$inject=["$q","Config"]}(),function(){"use strict";function e(e){function t(){return e.get("http://ws.brf-horizonte.com/get/images/?token=560a100abad225d5afdf4fc6e5334917")}var n={getAllImages:t};return n}angular.module("brfPhoneGapApp").factory("Image",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var n=this;return n.validateUser=function(t,n){return e.get("http://ws.brf-horizonte.com/validate/user/?token=560a100abad225d5afdf4fc6e5334917&email="+t+"&pass="+n)},n.authenticated=function(){return void 0!=BrfNameSpace.Session.getInstance().get()},n.authenticate=function(e){BrfNameSpace.Session.getInstance().set(e)},n.getToken=function(e){return BrfNameSpace.Session.getInstance().get()},n}angular.module("brfPhoneGapApp").factory("Login",e),e.$inject=["$http","Database"]}(),function(){"use strict";function e(e,t){var n=this;return n.synchronizeModules=function(){return e.get("http://ws.brf-horizonte.com/get/modules/?token=560a100abad225d5afdf4fc6e5334917")},n.synchronizeMainModules=function(){return e.get("http://ws.brf-horizonte.com/get/modules/main/?token=560a100abad225d5afdf4fc6e5334917")},n.setMainModule=function(e,n,o,r,a){t.query("INSERT INTO MainModule(id, mod_name, icon, map_label, has_dashboard) VALUES (?, ?, ?, ?, ?)",[e,n,o,r,a]).then(function(e){return!0})},n.setModule=function(e,n,o,r,a,u,i,s){t.query("INSERT INTO Module(moduleId, behavior, modName, categoryType, color, icon, slug, idMainMod) VALUES(?, ?, ?, ?, ?, ?, ?, ?)",[e,n,o,r,a,u,i,s]).then(function(e){return!0})},n.setModuleChannels=function(e,n){t.query("INSERT INTO ModuleChannels(moduleId, channelId) VALUES(?, ?)",[e,n]).then(function(e){return!0})},n.setModuleRoles=function(e,n){t.query("INSERT INTO ModuleUserRoles(moduleId, roleId) VALUES(?, ?)",[e,n]).then(function(e){return!0})},n.getModuleByName=function(e){return t.query("SELECT id, moduleId, behavior, modName, categoryType, color, icon FROM Module WHERE modName = ?",[e]).then(function(e){return t.fetch(e)})},n.getModuleBySlug=function(e){return t.query("SELECT id, moduleId, behavior, modName, categoryType, color, icon, slug FROM Module WHERE slug = ?",[e]).then(function(e){return t.fetch(e)})},n.getModules=function(e,n,o){var r="SELECT DISTINCT mod.id, mod.moduleId, mod.behavior, mod.modName, mod.categoryType, mod.color, mod.icon, mod.slug FROM Module mod INNER JOIN ModuleChannels modcha ON modcha.moduleId = mod.moduleId INNER JOIN ModuleUserRoles modur ON modur.moduleId = mod.moduleId WHERE modcha.channelId = ? AND modur.roleId = ? AND mod.idMainMod = ?";return t.query(r,[e,n,o]).then(function(e){return t.fetchAll(e)})},n.getDefaultModules=function(e,n){var o="SELECT DISTINCT mod.id, mod.moduleId, mod.behavior, mod.modName, mod.categoryType, mod.color, mod.icon, mod.slug FROM Module mod INNER JOIN ModuleChannels modcha ON modcha.moduleId = mod.moduleId INNER JOIN ModuleUserRoles modur ON modur.moduleId = mod.moduleId WHERE modcha.channelId = ? AND modur.roleId = ? LIMIT 0,1";return t.query(o,[e,n]).then(function(e){return t.fetch(e)})},n.getModuleById=function(e){return t.query("SELECT * FROM Module WHERE moduleId = ?",[e]).then(function(e){return t.fetch(e)})},n.getMainModules=function(){return t.query("SELECT * FROM MainModule").then(function(e){return t.fetchAll(e)})},n}angular.module("brfPhoneGapApp").factory("Module",e),e.$inject=["$http","Database"]}(),function(){"use strict";function e(e,t){var n=this;return n.synchronizeQuestions=function(){return e.get("http://ws.brf-horizonte.com/get/questions/?token=560a100abad225d5afdf4fc6e5334917")},n.setQuestion=function(e){return t.query("INSERT INTO Question(questionId, categoryId, render, answer, title, data, helper, big, thumb, questionModuleId, config, styling) VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[e.questionId,e.categoryId,e.render,e.answer,e.title,e.data,e.helper,e.big,e.thumb,e.questionModuleId,e.config,e.styling]).then(function(e){return!0})},n.setQuestionPdv=function(e,n){return t.query("INSERT INTO QuestionPdv(questionId, pdvId) VALUES(?, ?)",[e,n]).then(function(e){return!0})},n.getQuestions=function(e,n,o,r){var a;return a=0===r?"SELECT q.questionId, q.render, q.answer, q.title, q.data, q.helper, q.config, q.styling, res.JSONData FROM Question q LEFT JOIN SurveyQuestionsResults res ON res.questionId = q.questionId AND res.surveyId = ? INNER JOIN Module mod ON mod.moduleId = q.questionModuleId WHERE q.questionModuleId = ?":"SELECT q.questionId, q.render, q.answer, q.title, q.data, q.helper, q.config, q.styling, res.JSONData FROM Question q LEFT JOIN SurveyQuestionsResults res ON res.questionId = q.questionId AND res.surveyId = ? INNER JOIN Module mod ON mod.moduleId = q.questionModuleId INNER JOIN Category cat ON cat.categoryId = q.categoryId AND cat.type = mod.categoryType WHERE q.questionModuleId = ?",
void 0!==o&&null!==o&&0!=o&&(a=a+" AND q.categoryId = "+o),t.query(a,[n,e]).then(function(e){for(var t=[],n=function(e,t){var n;if(null===e)switch(t){case"binary":n={};break;case"open":n={value:""};break;case"price":n={value:""};break;case"multiple":n=[]}else"multiple"!==t&&(n=JSON.parse(e));return n},o=function(e,t,n){return null===e?n:"multiple"!==t?n:(n.answer_config.selected=JSON.parse(e),n)},r=0;r<e.rows.length;r++)t.push({id:e.rows.item(r).questionId,render:e.rows.item(r).render,answer:e.rows.item(r).answer,title:e.rows.item(r).title,data:e.rows.item(r).data,helper:e.rows.item(r).helper,config:o(e.rows.item(r).JSONData,e.rows.item(r).answer,JSON.parse(e.rows.item(r).config)),styling:JSON.parse(e.rows.item(r).styling),JSONData:n(e.rows.item(r).JSONData,e.rows.item(r).answer)});return t})},n.getQuestionsBySurveyId=function(e){return t.query("SELECT questionId, JSONData AS [value] FROM SurveyQuestionsResults WHERE surveyId = ?",[e]).then(function(e){return t.fetchAll(e)})},n}angular.module("brfPhoneGapApp").factory("Question",e),e.$inject=["$http","Database"]}(),function(){"use strict";function e(e,t){var n=this;return n.synchronizeSellers=function(){return e.get("http://ws.brf-horizonte.com/get/sellers/?token=560a100abad225d5afdf4fc6e5334917")},n.setSeller=function(e,n){return t.query("INSERT INTO Seller(id, name) VALUES(?, ?)",[e,n]).then(function(e){return!0})},n.getSellers=function(){return t.query("SELECT id, name FROM Seller").then(function(e){return t.fetchAll(e)})},n.setChoosenPdv=function(e){window.localStorage.setItem(pdvKeyId,e)},n}angular.module("brfPhoneGapApp").factory("Seller",e),e.$inject=["$http","Database"]}();var auditModeKey="audit-mode",channelKeyId="channel-id",pdvKeyId="pdv-id",sellerKeyId="seller-id",lastChannelKeyId="last-channel-id",lastSellerKeyId="last-seller-id",lastPdvKeyId="last-pdv-id",auditIdKey="audit-id";!function(){"use strict";function e(e,t){var n=this;return n.setSurvey=function(e,n,o,r,a){return t.query("INSERT INTO Survey(survey, syncStatus, channelId, pdvId, sellerId, userId) VALUES (?, ?, ?, ?, ?, ?)",[e,0,n,o,r,a]).then(function(e){return!0})},n.getPendingSurvey=function(){return t.query("SELECT id, survey, syncStatus FROM Survey WHERE syncStatus = 0 LIMIT 0,1").then(function(e){return e.rows.length>0?t.fetch(e):void 0})},n.closeSurvey=function(){return t.query("UPDATE Survey SET syncStatus = 1 WHERE syncStatus = 0").then(function(e){return!0})},n.enableAuditMode=function(e,t,n,o){window.localStorage.setItem(auditModeKey,!0),window.localStorage.setItem(channelKeyId,e),window.localStorage.setItem(pdvKeyId,t),window.localStorage.setItem(sellerKeyId,n),window.localStorage.setItem(lastChannelKeyId,e),window.localStorage.setItem(lastSellerKeyId,n),window.localStorage.setItem(lastPdvKeyId,t),window.localStorage.setItem(auditIdKey,o)},n.disableAuditMode=function(){window.localStorage.setItem(auditModeKey,!1),window.localStorage.setItem(channelKeyId,0),window.localStorage.setItem(pdvKeyId,0),window.localStorage.setItem(sellerKeyId,0),window.localStorage.setItem(auditIdKey,0)},n.getAuditId=function(){return void 0===window.localStorage.getItem(auditIdKey)&&window.localStorage.setItem(auditIdKey,0),window.localStorage.getItem(auditIdKey)},n.getAuditMode=function(){return void 0===window.localStorage.getItem(auditModeKey)&&window.localStorage.setItem(auditModeKey,!1),"true"===window.localStorage.getItem(auditModeKey)},n.getAuditChannel=function(){return void 0===window.localStorage.getItem(channelKeyId)&&window.localStorage.setItem(channelKeyId,0),window.localStorage.getItem(channelKeyId)},n.getLastAuditChannel=function(){return window.localStorage.getItem(lastChannelKeyId)},n.getAuditPdv=function(){return void 0===window.localStorage.getItem(pdvKeyId)&&window.localStorage.setItem(pdvKeyId,0),window.localStorage.getItem(pdvKeyId)},n.getLastAuditPdv=function(){return window.localStorage.getItem(lastPdvKeyId)},n.getAuditSeller=function(){return void 0===window.localStorage.getItem(sellerKeyId)&&window.localStorage.setItem(sellerKeyId,0),window.localStorage.getItem(sellerKeyId)},n.getLastAuditSeller=function(){return window.localStorage.getItem(lastSellerKeyId)},n.setQuestionAnswer=function(e,n,o){return t.query("UPDATE SurveyQuestionsResults SET JSONData = ? WHERE questionId = ? AND surveyId = ?",[o,n,e]).then(function(r){return 0===r.rowsAffected?t.query("INSERT INTO SurveyQuestionsResults(surveyId, questionId, JSONData) VALUES (?, ?, ?)",[e,n,o]).then(function(e){return!0}):!0})},n.deleteQuestionAnswer=function(e,n){return t.query("DELETE FROM SurveyQuestionsResults WHERE questionId = ? AND surveyId = ?",[n,e]).then(function(e){return!0})},n.setNoBrf=function(e,n){return t.query("UPDATE SurveyNoBrfResults SET noBrf = ? WHERE surveyId = ?",[n,e]).then(function(o){return 0===o.rowsAffected?t.query("INSERT INTO SurveyNoBrfResults(surveyId, noBrf) VALUES(?, ?)",[e,n]).then(function(e){return!0}):!0})},n.setObservations=function(e,n){return t.query("UPDATE SurveyObservationResults SET observations = ? WHERE surveyId = ?",[n,e]).then(function(o){return 0===o.rowsAffected?t.query("INSERT INTO SurveyObservationResults(surveyId, observations) VALUES(?, ?)",[e,n]).then(function(e){return!0}):!0})},n.getNoBrf=function(e){return t.query("SELECT noBrf FROM SurveyNoBrfResults WHERE surveyId = ?",[e]).then(function(e){return e.rows.length>0?t.fetch(e):void 0})},n.getObservations=function(e){return t.query("SELECT observations FROM SurveyObservationResults WHERE surveyId = ?",[e]).then(function(e){return e.rows.length>0?t.fetch(e):void 0})},n.getClosedSurveys=function(){return t.query("SELECT survey, syncStatus, channelId, pdvId, sellerId, userId, id FROM Survey WHERE syncStatus = 1").then(function(e){return t.fetchAll(e)})},n.getClosedSurveysNoBrf=function(){return t.query("SELECT sur.survey, nobrf.noBrf FROM SurveyNoBrfResults nobrf INNER JOIN Survey sur ON sur.id = nobrf.surveyId WHERE sur.syncStatus = 1").then(function(e){return t.fetchAll(e)})},n.informSurvey=function(t){var n={method:"POST",url:"http://ws.brf-horizonte.com/set/survey/?token=560a100abad225d5afdf4fc6e5334917",headers:{"Content-Type":"application/json"},data:t};return e(n)},n.informNoBrfSurvey=function(t){var n={method:"POST",url:"http://ws.brf-horizonte.com/set/survey/no-brf/?token=560a100abad225d5afdf4fc6e5334917",headers:{"Content-Type":"application/json"},data:t};return e(n)},n.informSurveyQuestions=function(t){var n={method:"POST",url:"http://ws.brf-horizonte.com/set/survey/questions/?token=560a100abad225d5afdf4fc6e5334917",headers:{"Content-Type":"application/json"},data:t};return e(n)},n}angular.module("brfPhoneGapApp").factory("Survey",e),e.$inject=["$http","Database"]}();var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){app.receivedEvent("deviceready")},receivedEvent:function(e){var t=document.getElementById(e),n=t.querySelector(".listening"),o=t.querySelector(".received");n.setAttribute("style","display:none;"),o.setAttribute("style","display:block;"),console.log("Received Event: "+e)}},BrfNameSpace=BrfNameSpace||{};BrfNameSpace.Session=function(){function e(){var e="brf-session";return{set:function(t){window.localStorage.setItem(e,JSON.stringify(t))},get:function(){var t=null;try{t=JSON.parse(window.localStorage.getItem(e))}catch(n){}return t}}}var t;return{getInstance:function(){return t||(t=e()),t}}}();