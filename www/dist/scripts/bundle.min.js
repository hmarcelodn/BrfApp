var brfPhoneGapApp=angular.module("brfPhoneGapApp",["ngRoute"]),db,app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){app.receivedEvent("deviceready")},receivedEvent:function(e){var t=document.getElementById(e),n=t.querySelector(".listening"),o=t.querySelector(".received");n.setAttribute("style","display:none;"),o.setAttribute("style","display:block;"),console.log("Received Event: "+e)}};brfPhoneGapApp.config(["$routeProvider",function(e){e.when("/Main",{templateUrl:"app/views/main.html",controller:"MainController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/Dashboard/:auditId",{templateUrl:"app/views/dashboard.html",controller:"DashboardController",access:{isFreeAccess:!1,audit:!1}}).when("/Audit/:auditId",{templateUrl:"app/views/welcome.html",controller:"WelcomeController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/Audit/:auditId/Channel",{templateUrl:"app/views/channels.html",controller:"ChannelsController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/Audit/:auditId/Channel/:channelId/Pdv",{templateUrl:"app/views/form.html",controller:"FormController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/Audit/:auditId/Channel/:channelId/AddPdv",{templateUrl:"app/views/new-pdv.html",controller:"PdvController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller",{templateUrl:"app/views/search.html",controller:"SearchController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/",{templateUrl:"app/views/login.html",controller:"LoginController",controllerAs:"vm",access:{isFreeAccess:!0}}).when("/Synchronizer/:syncModeId",{templateUrl:"app/views/synchronizer.html",controller:"SynchronizerController",access:{isFreeAccess:!1,audit:!1}}).when("/DoSynchronization",{templateUrl:"app/views/doSynchronization.html",controller:"DoSynchronizationController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/SendSynchronization",{templateUrl:"app/views/sendSynchronization.html",controller:"SendSynchronizationController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/SyncOk",{templateUrl:"app/views/syncOk.html",controller:"SyncOkController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/SyncNok",{templateUrl:"app/views/syncNok.html",controller:"SyncNokController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller/:sellerId/observaciones/:default?",{templateUrl:"app/views/observations.html",controller:"ObservationsController",access:{isFreeAccess:!1,audit:!0}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller/:sellerId/no_brf",{templateUrl:"app/views/noBrf.html",controller:"NoBrfController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!0}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller/:sellerId/Mandatory",{templateUrl:"app/views/mandatoryQuestions.html",controller:"MandatoryQuestionsController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!0}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller/:sellerId/Module/:moduleId",{templateUrl:"app/views/questions.html",controller:"QuestionsController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!0}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller/:sellerId/Module/:moduleId/Category/:categoryId/CategoryType/:categoryType",{templateUrl:"app/views/questions.html",controller:"QuestionsController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!0}}).when("/Audit/:auditId/Channel/:channelId/Pdv/:pdvId/Seller/:sellerId/:slug/:default?",{templateUrl:"app/views/categorySearch.html",controller:"CategoryController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!0}}).when("/Help/:questionId",{templateUrl:"app/views/help.html",controller:"HelpController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!0}}).when("/WebSQL",{templateUrl:"app/views/webSQL.html",controller:"WebSQLController",controllerAs:"vm",access:{isFreeAccess:!0}}).when("/beforeLogOff",{templateUrl:"app/views/beforeLogOff.html",controller:"BeforeLogOffController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).when("/LockSynchronization/:leftCoaching",{templateUrl:"app/views/lockSynchronization.html",controller:"LockSynchronizationController",controllerAs:"vm",access:{isFreeAccess:!1,audit:!1}}).otherwise({redirectTo:"/"})}]).run(function(e,t,n,o,r,a){r.init(),e.$on("$viewContentLoaded",function(e){$(".collapsible").collapsible(),$("select").material_select()}),e.$on("$routeChangeStart",function(e,r){void 0!=r.access&&(r.access.isFreeAccess||n.authenticated()||t.path("/")),void 0!=r.access?!r.access.audit&&o.getAuditMode()&&a.getModules(o.getAuditChannel(),n.getToken().id_role,o.getAuditId()).then(function(e){t.path("/Audit/"+o.getAuditId()+"/Channel/"+o.getAuditChannel()+"/Pdv/"+o.getAuditPdv()+"/Seller/"+o.getAuditSeller()+"/"+e[0].slug+"/defaultModule")}):t.path("/Main")})}),function(){"use strict";function e(e,t,n,o,r,a){function i(){}var u=this;o.isLoggingOff=0;var s=function(){o.isLoggingOff=1,e.dropAll().then(function(){t.authenticate(void 0),a.$emit("userLoggedOff")})};i(),u.logout=s}angular.module("brfPhoneGapApp").controller("BeforeLogOffController",e),e.$inject=["Database","Login","$location","$scope","$timeout","$rootScope"]}(),function(){"use strict";function e(e,t,n,o,r,a){function i(){void 0!==u.routeParams["default"]&&"defaultModule"===u.routeParams["default"]&&o.$emit("defaultModuleLoaded",u.routeParams),r.getModuleBySlug(u.routeParams.slug).then(function(t){switch(u.currentModule=t,t.slug){case"no_brf":a.path("/Audit/"+u.routeParams.auditId+"/Channel/"+u.routeParams.channelId+"/Pdv/"+u.routeParams.pdvId+"/Seller/"+u.routeParams.sellerId+"/no_brf");break;default:n.getCategories(t.categoryType,u.routeParams.channelId,t.moduleId).then(function(n){n.length>0?e.categories=n:a.path("/Audit/"+u.routeParams.auditId+"/Channel/"+u.routeParams.channelId+"/Pdv/"+u.routeParams.pdvId+"/Seller/"+u.routeParams.sellerId+"/Module/"+t.moduleId)})}})}var u=this;u.routeParams=t,u.currentModule,i()}angular.module("brfPhoneGapApp").controller("CategoryController",e),e.$inject=["$scope","$routeParams","Category","$rootScope","Module","$location"]}(),function(){"use strict";function e(e,t,n,o,r,a,i){function u(){o.getChannels(i.getToken().channels).then(function(e){var t=i.getToken().channels,o=new Array;angular.forEach(e,function(e,n){-1!==$.inArray(e.id.toString(),t)&&o.push(e)}),1===o.length?a.path("/Audit/"+n.auditId+"/Channel/"+e[0].id+"/Pdv"):(s.channels=o,s.lastChannelId=null===r.getLastAuditChannel()?void 0:r.getLastAuditChannel(),s.auditId=n.auditId)})}var s=this;s.channels=[],s.lastChannelId,s.auditId,u()}angular.module("brfPhoneGapApp").controller("ChannelsController",e),e.$inject=["$scope","$route","$routeParams","Channel","Survey","$location","Login"]}(),function(){"use strict";function e(e,t,n,o,r,a,i){function u(e){}u()}angular.module("brfPhoneGapApp").controller("CoachingController",e),e.$inject=["$scope","$route","$routeParams","Question","Survey","Module","$rootScope"]}(),function(){"use strict";function e(e,t,n,o,r,a,i,u){function s(){n.getDatings().then(function(t){e.datings=t}),u.all([i.getVisitedCoachingPdvsCount(a.getToken().id),n.getDailyBase(a.getToken().id)]).then(function(t){var n=t[0],o=t[1];e.visitedPDVs=void 0===n?0:n,0!=o.target_coaching&&(e.obtainedCompliance=Math.round(n/o.target_coaching*100),e.progressStyle={width:e.obtainedCompliance+"%"}),e.target=o.target_coaching}),i.getAveragePerModule(r.auditId).then(function(t){angular.forEach(t,function(t,n){o.getAuditedQuestionsResume(t.id_mod,r.auditId).then(function(n){e.modules.push({percents:t,points:n})})})})}e.selectedDating,e.modules=[],s()}angular.module("brfPhoneGapApp").controller("DashboardController",e),e.$inject=["$scope","$route","Dashboard","Question","$routeParams","Login","Survey","$q"]}(),function(){"use strict";function e(e,t,n,o,r,a,i,u,s,d,c,l,f,m,h){function g(){e.syncChannels=0,e.syncCustomers=0,e.syncCustomersType=0,e.syncSellers=0,e.syncMainModules=0,e.syncModules=0,e.syncCategories=0,e.syncCategoriesImg=0,e.syncQuestions=0,e.syncImages=0,e.syncDating=0,e.syncTarget=0,c.dropAll().then(function(){c.init();var t=n.defer();return e.syncChannels=1,a.synchronizeChannels().then(function(o){var r=[];angular.forEach(o.data.channels,function(e,t){r.push(a.setChannel(e.id,e.name))}),n.all(r).then(function(){e.syncChannels=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncCustomers=1,i.synchronizeCustomers().then(function(o){var r=[];angular.forEach(o.data.customers,function(e,t){r.push(i.setCustomer(e.id,e.company_name,e.cuit,e.address,e.type_pdv,e.highlighted))}),n.all(r).then(function(){e.syncCustomers=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncCustomersType=1,i.synchronizeCustomerTypes().then(function(o){var r=[];angular.forEach(o.data.customer_types,function(e,t){r.push(i.setCustomerType(e.id,e.name))}),n.all(r).then(function(){e.syncCustomersType=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncSellers=1,d.synchronizeSellers().then(function(o){var r=[];angular.forEach(o.data.sellers,function(e,t){r.push(d.setSeller(e.id,e.name))}),n.all(r).then(function(){e.syncSellers=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncMainModules=1,u.synchronizeMainModules().then(function(o){var r=[];angular.forEach(o.data.main_modules,function(e,t){r.push(u.setMainModule(e.id,e.mod_name,e.icon,e.map_label,e.has_dashboard))}),n.all(r).then(function(){e.syncMainModules=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncModules=1,u.synchronizeModules().then(function(o){var r=[];angular.forEach(o.data.modules,function(e,t){var n=e.id;r.push(u.setModule(e.id,e.behavior,e.mod_name,e.category_type,e.style.color,e.style.icon,e.slug,e.id_main_mod)),angular.forEach(e.ids_channels,function(e,t){r.push(u.setModuleChannels(n,e))}),angular.forEach(e.ids_user_roles,function(e,t){r.push(u.setModuleRoles(n,e))})}),n.all(r).then(function(){e.syncModules=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(t){var o=n.defer();return e.syncCategories=1,r.synchronizeCategories().then(function(t){var a=[];angular.forEach(t.data.categories,function(e,t){var n=e.id;a.push(r.setCategory(e.id,e.type,e.name)),angular.forEach(e.id_channels,function(e,t){a.push(r.setCategoryChannel(n,e))})}),n.all(a).then(function(){e.syncCategories=2,o.resolve()})})["catch"](function(e){o.reject(e)}),o.promise}).then(function(){var t=n.defer();return e.syncCategoriesImg=1,r.synchronizeCategoryImages().then(function(o){var a=[];angular.forEach(o.data.categories_images,function(e,t){a.push(r.setCategoryImage(e.id,e.id_mod,e.id_cat,void 0===y.devicePath?e.image:cordova.file.externalApplicationStorageDirectory+"BRF/Images/"+e.image.split("/").pop(),e.icon))}),n.all(a).then(function(){e.syncCategoriesImg=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncQuestions=1,s.synchronizeQuestions().then(function(o){var r=[];angular.forEach(o.data.questions,function(e,t){var n=e.id;r.push(s.setQuestion({questionId:e.id,categoryId:e.id_category,render:e.render,answer:e.answer,title:e.title,data:e.data,helper:e.helper,big:void 0===y.devicePath?e.big:cordova.file.externalApplicationStorageDirectory+"BRF/Images/"+e.big.split("/").pop(),thumb:void 0===y.devicePath?e.thumb:cordova.file.externalApplicationStorageDirectory+"BRF/Images/"+e.thumb.split("/").pop(),questionModuleId:e.id_question_mod,config:"object"==typeof e.config?JSON.stringify(e.config):e.config,styling:"object"==typeof e.styling?JSON.stringify(e.styling):e.styling,is_mandatory:e.is_mandatory,has_percent:e.has_percent,is_dashboard:e.is_dashboard,weight:e.weight,is_coaching:e.is_coaching})),angular.forEach(e.pdv_filter,function(e,t){r.push(s.setQuestionPdv(n,e))})}),n.all(r).then(function(){e.syncQuestions=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();if(e.syncImages=1,void 0===y.devicePath)return e.syncImages=2,void t.resolve();new FileTransfer;return l.getAllImages().then(function(o){var r=[],a=function(e){var t=n.defer();return window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(n){var o=new FileTransfer;o.download(encodeURI(e),cordova.file.externalApplicationStorageDirectory+"BRF/Images/"+e.split("/").pop(),function(n){console.log("Success:"+e.split("/").pop()),t.resolve()},function(n){console.log("Error: "+e.split("/").pop()),t.reject(n)})}),t.promise};angular.forEach(o.data.images,function(e,t){void 0!==e.thumb&&r.push(a(e.thumb)),void 0!==e.big&&r.push(a(e.big))}),n.all(r).then(function(){e.syncImages=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer();return e.syncDating=1,m.synchronizeDating().then(function(o){var r=[];angular.forEach(o.data.dating,function(e,t){r.push(m.setDating(e.id,e.type,e.label))}),n.all(r).then(function(){e.syncDating=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){var t=n.defer(),o=h.getToken().id;return e.syncTarget=1,m.synchronizeTargets(o).then(function(r){var a=[];angular.forEach(r.data.targets,function(e,t){a.push(m.setTarget(e.target_coaching,o))}),n.all(a).then(function(){e.syncTarget=2,t.resolve()})})["catch"](function(e){t.reject(e)}),t.promise}).then(function(){f.$emit("synchronizationSuccessfulyFinished"),o.path("/SyncOk")})["catch"](function(e){console.log(e),o.path("/SyncNok")})}var y=this;y.devicePath=void 0,navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/)&&(y.devicePath=cordova.file.externalApplicationStorageDirectory),g()}angular.module("brfPhoneGapApp").controller("DoSynchronizationController",e),e.$inject=["$scope","$route","$q","$location","Category","Channel","Customer","Module","Question","Seller","Database","Image","$rootScope","Dashboard","Login"]}(),function(){"use strict";function e(e,t,n,o,r,a){function i(){console.log("Ejecución PDV"),r.getModuleByName("Ejecución PDV").then(function(t){a.getPendingSurvey().then(function(r){void 0!==n.categoryId?o.getQuestions(t.moduleId,r.id,n.categoryId).then(function(t){e.questions=t}):o.getQuestions(t.moduleId,r.id,void 0,t.categoryType).then(function(t){e.questions=t})})})}i()}angular.module("brfPhoneGapApp").controller("ExecutionController",e),e.$inject=["$scope","$route","$routeParams","Question","Module","Survey"]}(),function(){"use strict";function e(e,t,n,o,r){function a(){e.channelId=n.channelId,o.getCustomers().then(function(e){i.customers=e,i.lastPdvId=null===r.getLastAuditPdv()?void 0:r.getLastAuditPdv(),i.auditId=n.auditId})}var i=this;e.channelId,i.customers=[],i.lastPdvId,i.auditId,a()}angular.module("brfPhoneGapApp").controller("FormController",e),e.$inject=["$scope","$route","$routeParams","Customer","Survey"]}(),function(){"use strict";function e(e,t,n){function o(){n.getQuestionById(t.questionId).then(function(t){e.title=t.title,e.helpBody=t.helper})}o()}angular.module("brfPhoneGapApp").controller("HelpController",e),e.$inject=["$scope","$routeParams","Question"]}(),function(){"use strict";function e(e,t){function n(){}n()}angular.module("brfPhoneGapApp").controller("MainController",e),e.$inject=["$scope","$route"]}(),function(){"use strict";function e(e,t){function n(){t.leftCoaching=e.leftCoaching}n()}angular.module("brfPhoneGapApp").controller("LockSynchronizationController",e),e.$inject=["$routeParams","$scope"]}(),function(){"use strict";function e(e,t,n,o,r,a,i,u,s,d,c){function l(){o.authenticated()&&(n.path("/Main"),p(),f.routeParams=a,u.getMainModules().then(function(e){m()}))}var f=this;f.username,f.password,f.routeParams,e.auditCustomerName,e.mainModules=[],e.loggedUserName="";var m=function(){u.getMainModules().then(function(t){e.mainModules=t,p()})},h=function(){u.getModules(r.getAuditChannel(),o.getToken().id_role,r.getAuditId()).then(function(t){e.modules=t,r.getAuditMode()===!0&&s.getPdvById(r.getAuditPdv()).then(function(t){e.auditCustomerName=t.address})}),$(".button-collapse").sideNav("show")},g=function(){o.validateUser(f.username,f.password).then(function(e){"string"==typeof e.data?"false"===e.data.trim()&&(f.username="",f.password=""):"object"==typeof e.data&&(o.authenticate(e.data),n.path("/Main"))})},y=function(){if(!o.authenticated())return"";var e=o.getToken();return e.name},p=function(){e.loggedUserName=f.getUserName()};i.$on("defaultModuleLoaded",function(e,t){r.getPendingSurvey().then(function(e){void 0===e?(f.routeParams=t,s.getPdvTypeByCustomerId(t.pdvId).then(function(e){r.setSurvey((new Date).getTime().toString(),t.channelId,e.pdvType,t.sellerId,o.getToken().id).then(function(){r.enableAuditMode(t.channelId,t.pdvId,t.sellerId,t.auditId),f.loadModules()})})):f.loadModules()})}),i.$on("synchronizationSuccessfulyFinished",function(e,t){console.log("Received Event synchronizationSuccessfulyFinished"),m()}),i.$on("userLoggedOff",function(){console.log("userLoggedOff"),e.mainModules=[],n.path("/")}),i.$on("sendSyncFinished",function(){console.log("sendSyncFinished"),e.mainModules=[],n.path("/")}),i.$on("closedSurvey",function(t,n){console.log("closedSurvey"),e.auditCustomerName=""}),e.authenticated=function(){return o.authenticated()},e.isAuditModeEnabled=function(){return r.getAuditMode()},f.loadModules=h,f.login=g,f.getUserName=y,l()}angular.module("brfPhoneGapApp").controller("LoginController",e),e.$inject=["$scope","$route","$location","Login","Survey","$routeParams","$rootScope","Module","Customer","Database","$timeout"]}(),function(){"use strict";function e(e,t,n,o,r,a){function i(){var i=n.getToken().id_role;o.getPendingSurvey().then(function(n){r.all([e.getMandatoryQuestions(n.id,i,a.pdvId,a.auditId),e.getSuggestedQuestions(n.id,i,a.pdvId,a.auditId)]).then(function(e){t.mandatoryQuestions=e[0],t.suggestedQuestions=e[1]})})}var u=this;u.routeParams=a,i();var s=function(){o.getPendingSurvey().then(function(e){o.closeSurvey(n.getToken().id_role,a.channelId,e.id,a.auditId)})};u.closeSurvey=s}angular.module("brfPhoneGapApp").controller("MandatoryQuestionsController",e),e.$inject=["Question","$scope","Login","Survey","$q","$routeParams"]}(),function(){"use strict";function e(e,t){function n(){e.noBrfChanged=function(){t.getPendingSurvey().then(function(n){t.setNoBrf(n.id,e.noBrfStatus).then(function(){})})}}n()}angular.module("brfPhoneGapApp").controller("NoBrfController",e),e.$inject=["$scope","Survey"]}(),function(){"use strict";function e(e,t){function n(){t.getPendingSurvey().then(function(n){t.getObservations(n.id).then(function(t){void 0===t?e.observations="":e.observations=t.observations})}),e.observationsChanged=function(){t.getPendingSurvey().then(function(n){t.setObservations(n.id,e.observations).then(function(){})})}}e.observations,n()}angular.module("brfPhoneGapApp").controller("ObservationsController",e),e.$inject=["$scope","Survey"]}(),function(){"use strict";function e(e,t,n,o,r,a){function i(){r.getCustomerTypes().then(function(t){e.customerTypes=t,e.selectedCustomerType=e.customerTypes[0]}),u.lastPdvId=null===a.getLastAuditPdv()?void 0:a.getLastAuditPdv()}var u=this;u.lastPdvId,e.customerTypes=[],e.companyName,e.identifier,e.address;var s=function(){r.setCustomer(0,e.companyName,e.identifier,e.address,e.selectedCustomerType.id).then(function(){n.path("/Audit/"+o.auditId+"/Channel/"+o.channelId+"/Pdv/0/Seller")})};u.addPdv=s,i()}angular.module("brfPhoneGapApp").controller("PdvController",e),e.$inject=["$scope","$route","$location","$routeParams","Customer","Survey"]}(),function(){"use strict";function e(e,t,n,o,r){function a(){console.log("Toma de Precios"),o.getModuleByName("Toma de Precios").then(function(o){r.getPendingSurvey().then(function(r){n.getQuestions(o.moduleId,r.id,t.categoryId,o.categoryType).then(function(t){e.questions=t})})})}a()}angular.module("brfPhoneGapApp").controller("PricesController",e),e.$inject=["$scope","$routeParams","Question","Module","Survey"]}(),function(){"use strict";function e(e,t,n,o,r,a){function i(){var t=e.questions.filter(function(e){return 1===e.has_percent}),n=0;angular.forEach(t,function(e){n+=""===e.JSONData.value?0:parseInt(e.JSONData.value)}),angular.forEach(t,function(e){e.percent=parseInt(100*(""===e.JSONData.value?0:e.JSONData.value/n))})}function u(){void 0!==n.categoryId?t.getPendingSurvey().then(function(t){r.getCategoryById(n.categoryId).then(function(e){s.currentCategory=e}),a.getModuleById(n.moduleId).then(function(e){s.currentModule=e}),o.getQuestions(n.moduleId,t.id,n.categoryId,n.categoryType).then(function(t){e.questions=t,i()})}):a.getModuleById(n.moduleId).then(function(r){s.currentModule=r,t.getPendingSurvey().then(function(t){void 0!==t?o.getQuestions(r.moduleId,t.id,void 0,r.categoryType).then(function(t){e.questions=t,i()}):o.getQuestions(n.moduleId,0,void 0,r.categoryType).then(function(t){e.questions=t,i()})})})}var s=this;s.currentCategory,s.currentModule,e.questions=[],e.routeParams=n;var d=function(e,n){var o={value:n};t.getPendingSurvey().then(function(n){t.setQuestionAnswer(n.id,e.id,JSON.stringify(o)).then(function(){e.JSONData=o})})},c=function(e){t.getPendingSurvey().then(function(n){t.deleteQuestionAnswer(n.id,e.id).then(function(){e.JSONData=void 0})})},l=function(e){t.getPendingSurvey().then(function(n){t.setQuestionAnswer(n.id,e.id,JSON.stringify(e.JSONData)).then(function(){i()})})},f=function(e){t.getPendingSurvey().then(function(n){t.setQuestionAnswer(n.id,e.id,JSON.stringify(e.JSONData)).then(function(){})})},m=function(e){t.getPendingSurvey().then(function(n){t.setQuestionAnswer(n.id,e.id,JSON.stringify(e.config.answer_config.selected)).then(function(){})})};e.range=function(e){return new Array(e)};var h=function(){$("#modal1").openModal()},g=function(e){$("#questionModal"+e.id).openModal()};s.binaryAction=d,s.undoBinaryAction=c,s.openAction=l,s.priceAction=f,s.multipleAction=m,s.openModal=h,s.openBigImageModal=g,u()}angular.module("brfPhoneGapApp").controller("QuestionsController",e),e.$inject=["$scope","Survey","$routeParams","Question","Category","Module"]}(),function(){"use strict";function e(e,t,n,o,r,a,i){function u(){r.getModules(e.channelId,a.getToken().id_role,e.auditId).then(function(t){e.defaultModuleSlug=t[0].slug}),o.getSellers().then(function(t){e.sellers=t}),s.lastSellerId=null===i.getLastAuditSeller()?void 0:i.getLastAuditSeller(),s.auditId=n.auditId}var s=this;s.lastSellerId,e.pdvId=n.pdvId,e.channelId=n.channelId,e.auditId=n.auditId,e.defaultModuleSlug,s.auditId,u()}angular.module("brfPhoneGapApp").controller("SearchController",e),e.$inject=["$scope","$route","$routeParams","Seller","Module","Login","Survey"]}(),function(){"use strict";function e(e,t,n,o,r,a,i,u){function s(){t.getClosedSurveys().then(function(n){e.syncSurveys=1;var r=o.defer(),i=[];return angular.forEach(n,function(n,u){a.getPdvById(n.pdvId).then(function(e){i.push(t.informSurvey(JSON.stringify({data:{main:{id_user:n.userId,survey:n.survey,token:"560a100abad225d5afdf4fc6e5334917"},config:{id_channel:n.channelId,id_type_pdv:n.pdvId,id_seller:n.sellerId},details:{name:e.companyName,address:e.address,notes:"Test Notes"}}})).then(function(){r.resolve()})["catch"](function(e){r.reject(e)}))}),o.all(i).then(function(){e.syncSurveys=2,r.resolve()})}),r.promise}).then(function(){e.syncNoBrf=1;var n=o.defer();return t.getClosedSurveysNoBrf().then(function(r){if(r.length>0){var a=[];angular.forEach(r,function(e,n){a.push(t.informNoBrfSurvey(JSON.stringify({data:{token:"560a100abad225d5afdf4fc6e5334917",id_user:e.userId,survey:e.survey}})))}),o.all(a).then(function(){e.syncNoBrf=2,n.resolve()})}else e.syncNoBrf=2,n.resolve()}),n.promise}).then(function(){e.syncQuestions=1;var n=o.defer(),a=new Array;return t.getClosedSurveys().then(function(e){angular.forEach(e,function(e,n){r.getQuestionsBySurveyId(e.id).then(function(n){a.push(t.informSurveyQuestions(JSON.stringify({data:{main:{survey:e.survey,token:"560a100abad225d5afdf4fc6e5334917"},results:{questions:n}}})))})})}),o.all(a).then(function(){e.syncQuestions=2,n.resolve()}),n.promise}).then(function(){var e=o.defer();return i.dropAll().then(function(){e.resolve()}),e.promise}).then(function(){u.$emit("sendSyncFinished"),n.path("/SyncOk")})["catch"](function(e){console.log(e),n.path("/SyncNok")})}e.syncSurveys=0,e.syncNoBrf=0,e.syncQuestions=0,s()}angular.module("brfPhoneGapApp").controller("SendSynchronizationController",e),e.$inject=["$scope","Survey","$location","$q","Question","Customer","Database","$rootScope"]}(),function(){"use strict";function e(e,t,n,o,r,a,i,u,s){function d(){}var c=this;c.routeParams=i;var l=function(){var e=i.auditId,t=i.channelId,s=i.pdvId,d=i.sellerId,c=r.getToken().id_role;o.getPendingSurvey().then(function(r){u.all([a.getMandatoryQuestions(r.id,c,t,e),a.getSuggestedQuestions(r.id,c,t,e)]).then(function(a){var i=a[0],u=a[1];i.length>0||u.length>0?n.path("/Audit/"+e+"/Channel/"+t+"/Pdv/"+s+"/Seller/"+d+"/Mandatory"):o.closeSurvey(c,t,r.id,e)})})};d(),c.closeAudit=l}angular.module("brfPhoneGapApp").controller("SurveyController",e),e.$inject=["$scope","$route","$location","Survey","Login","Question","$routeParams","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n,o,r,a){function i(){1===parseInt(e.syncModeId)?n.syncRoute="#/DoSynchronization":a.all([r.getCoachingComplianceSurvey(),o.getTargetCoaching()]).then(function(e){var t=e[0],o=e[1];t.length<o.target_coaching?n.syncRoute="#/LockSynchronization/"+(parseInt(o.target_coaching)-t.length).toString():n.syncRoute="#/SendSynchronization"})}n.syncRoute,i()}angular.module("brfPhoneGapApp").controller("SynchronizerController",e),e.$inject=["$routeParams","$location","$scope","Target","Survey","$q"]}(),function(){"use strict";function e(){function e(){}e()}angular.module("brfPhoneGapApp").controller("SyncNokController",e),e.$inject=[]}(),function(){"use strict";function e(){function e(){}e()}angular.module("brfPhoneGapApp").controller("SyncOkController",e),e.$inject=[]}(),function(){"use strict";function e(e,t){function n(){}n(),e.query,e.run=function(){t.query(e.query).then(function(e){console.log(t.fetchAll(e))})}}angular.module("brfPhoneGapApp").controller("WebSQLController",e),e.$inject=["$scope","Database"]}(),function(){"use strict";function e(e){function t(){}var n=this;n.auditId=e.auditId,t()}angular.module("brfPhoneGapApp").controller("WelcomeController",e),e.$inject=["$routeParams"]}(),brfPhoneGapApp.directive("questions",function(){return{restrict:"E",scope:{content:"="},templateUrl:"app/partials/questions.html",replace:!0}}),function(){"use strict";function e(e,t){var n=function(){return e.get("https://ws.conecta-brf.com/get/categories/?token=560a100abad225d5afdf4fc6e5334917")},o=function(){return e.get("https://ws.conecta-brf.com/get/categories/images/?token=560a100abad225d5afdf4fc6e5334917")},r=function(e,n,o){return t.query("INSERT INTO Category(categoryId, type, name) VALUES(?, ?, ?)",[e,n,o]).then(function(e){return!0})},a=function(e,n){return t.query("INSERT INTO CategoryChannels(categoryId, channelId) VALUES(?, ?)",[e,n]).then(function(e){return!0})},i=function(e,n,o,r,a){return t.query("INSERT INTO CategoryImage(imageId, idMod, idCat, image, icon) VALUES(?, ?, ?, ?, ?)",[e,n,o,r,a]).then(function(e){return!0})},u=function(e,n,o){var r=" SELECT * FROM Category cat2 WHERE cat2.id IN ( SELECT DISTINCT cat.id FROM Category cat INNER JOIN CategoryChannels catchan ON catchan.categoryId = cat.categoryId INNER JOIN Question q ON q.categoryId = cat.categoryId WHERE cat.type = ? AND catchan.channelId = ? AND q.questionModuleId = ? )";return t.query(r,[e,n,o]).then(function(e){return t.fetchAll(e)})},s=function(e){return t.query("SELECT * FROM Category WHERE CategoryId = ?",[e]).then(function(e){return t.fetch(e)})},d={synchronizeCategories:n,synchronizeCategoryImages:o,setCategory:r,setCategoryChannel:a,setCategoryImage:i,getCategories:u,getCategoryById:s};return d}angular.module("brfPhoneGapApp").factory("Category",e),e.$inject=["$http","Database"]}(),function(){"use strict";function e(e,t){var n=function(){return e.get("https://ws.conecta-brf.com/get/channels/?token=560a100abad225d5afdf4fc6e5334917")},o=function(e,n){return t.query("INSERT INTO Channel(id, name) VALUES(?, ?)",[e,n]).then(function(e){return!0})},r=function(e){return t.query("SELECT id, name From Channel").then(function(e){return t.fetchAll(e)})},a={synchronizeChannels:n,setChannel:o,getChannels:r};return a}angular.module("brfPhoneGapApp").factory("Channel",e),e.$inject=["$http","Database"]}(),brfPhoneGapApp.factory("Config",function(){var e=this;return e.DB_CONFIG={name:"BRF",tables:[{name:"Category",columns:[{name:"id",type:"integer primary key"},{name:"categoryId",type:"integer"},{name:"type",type:"integer"},{name:"name",type:"text"}]},{name:"CategoryChannels",columns:[{name:"id",type:"integer primary key"},{name:"categoryId",type:"integer"},{name:"channelId",type:"integer"}]},{name:"CategoryImage",columns:[{name:"id",type:"integer primary key"},{name:"imageId",type:"integer"},{name:"idMod",type:"integer"},{name:"idCat",type:"integer"},{name:"image",type:"text"},{name:"icon",type:"text"}]},{name:"Channel",columns:[{name:"id",type:"integer primary key"},{name:"name",type:"text"}]},{name:"Customer",columns:[{name:"id",type:"integer primary key"},{name:"customerId",type:"integer"},{name:"companyName",type:"text"},{name:"cuit",type:"text"},{name:"address",type:"text"},{name:"pdvType",type:"integer"},{name:"highlighted",type:"integer"}]},{name:"CustomerType",columns:[{name:"id",type:"integer primary key"},{name:"name",type:"text"}]},{name:"Module",columns:[{name:"id",type:"integer primary key"},{name:"moduleId",type:"integer"},{name:"behavior",type:"text"},{name:"modName",type:"text"},{name:"categoryType",type:"integer"},{name:"color",type:"text"},{name:"icon",type:"text"},{name:"slug",type:"text"},{name:"idMainMod",type:"integer"}]},{name:"ModuleChannels",columns:[{name:"id",type:"integer primary key"},{name:"moduleId",type:"integer"},{name:"channelId",type:"integer"}]},{name:"ModuleUserRoles",columns:[{name:"id",type:"integer primary key"},{name:"moduleId",type:"integer"},{name:"roleId",type:"integer"}]},{name:"Question",columns:[{name:"id",type:"integer primary key"},{name:"questionId",type:"integer"},{name:"categoryId",type:"integer"},{name:"render",type:"text"},{name:"answer",type:"text"},{name:"title",type:"text"},{name:"data",type:"text"},{name:"helper",type:"text"},{name:"big",type:"text"},{name:"thumb",type:"text"},{name:"questionModuleId",type:"integer"},{name:"config",type:"text"},{name:"styling",type:"text"},{name:"is_mandatory",type:"integer"},{name:"has_percent",type:"integer"},{name:"is_dashboard",type:"integer"},{name:"weight",type:"integer"},{name:"is_coaching",type:"integer"}]},{name:"QuestionPdv",columns:[{name:"id",type:"integer primary key"},{name:"questionId",type:"integer"},{name:"pdvId",type:"integer"}]},{name:"Seller",columns:[{name:"id",type:"integer primary key"},{name:"name",type:"name"}]},{name:"Survey",columns:[{name:"id",type:"integer primary key"},{name:"survey",type:"text"},{name:"syncStatus",type:"integer"},{name:"channelId",type:"integer"},{name:"pdvId",type:"integer"},{name:"sellerId",type:"integer"},{name:"userId",type:"integer"},{name:"date",type:"datetime"},{name:"coaching_compliance",type:"integer"}]},{name:"SurveyNoBrfResults",columns:[{name:"id",type:"integer primary key"},{name:"surveyId",type:"integer"},{name:"noBrf",type:"boolean"}]},{name:"SurveyObservationResults",columns:[{name:"id",type:"integer primary key"},{name:"surveyId",type:"integer"},{name:"observations",type:"text"}]},{name:"SurveyQuestionsResults",columns:[{
name:"id",type:"integer primary key"},{name:"surveyId",type:"integer"},{name:"questionId",type:"integer"},{name:"JSONData",type:"text"}]},{name:"MainModule",columns:[{name:"id",type:"integer primary key"},{name:"mod_name",type:"text"},{name:"icon",type:"text"},{name:"map_label",type:"text"},{name:"has_dashboard",type:"integer"}]},{name:"Dating",columns:[{name:"id",type:"integer"},{name:"type",type:"text"},{name:"label",type:"text"}]},{name:"Target",columns:[{name:"id",type:"integer primary key"},{name:"target_coaching",type:"integer"},{name:"id_user",type:"integer"}]},{name:"AuditFinalValues",columns:[{name:"id_audit",type:"integer"},{name:"id_mod",type:"integer"},{name:"final_value",type:"numeric"},{name:"mod_name",type:"text"},{name:"icon",type:"text"},{name:"id_mainmod",type:"integer"}]}]},e}),function(){"use strict";function e(e,t){var n=function(){return e.get("https://ws.conecta-brf.com/get/customers/?token=560a100abad225d5afdf4fc6e5334917")},o=function(t){return e.get("https://ws.conecta-brf.com/get/customers/type/?token=560a100abad225d5afdf4fc6e5334917")},r=function(e,n,o,r,a,i){return t.query("INSERT INTO Customer(customerId, companyName, cuit, address, pdvType, highlighted) VALUES(?, ?, ?, ?, ?, ?)",[e,n,o,r,a,i]).then(function(e){return!0})},a=function(e,n){return t.query("INSERT INTO CustomerType(id, name) VALUES(?, ?)",[e,n]).then(function(e){return!0})},i=function(){return t.query("SELECT customerId, address, highlighted FROM Customer LIMIT 0, 2000").then(function(e){return t.fetchAll(e)})},u=function(){return t.query("SELECT id, name FROM CustomerType").then(function(e){return t.fetchAll(e)})},s=function(e){return t.query("SELECT pdvType FROM Customer").then(function(e){return t.fetch(e)})},d=function(e){return t.query("SELECT * FROM Customer WHERE CustomerId = ?",[e]).then(function(e){return t.fetch(e)})},c={synchronizeCustomers:n,synchronizeCustomerTypes:o,setCustomer:r,setCustomerType:a,getCustomers:i,getCustomerTypes:u,getPdvTypeByCustomerId:s,getPdvById:d};return c}angular.module("brfPhoneGapApp").factory("Customer",e),e.$inject=["$http","Database"]}(),function(){"use strict";function e(e,t){function n(){return e.get("https://ws.conecta-brf.com/get/dashboard/dating/?token=560a100abad225d5afdf4fc6e5334917")}function o(t){return e.get("https://ws.conecta-brf.com/get/user/target/?token=560a100abad225d5afdf4fc6e5334917&id_user="+t)}function r(e,n,o){return t.query("INSERT INTO Dating(id, type, label) VALUES(?,?, ?)",[e,n,o]).then(function(){return!0})}function a(e,n){return t.query("INSERT INTO Target(target_coaching, id_user) VALUES (?, ?)",[e,n]).then(function(){return!0})}function i(e){return t.query("SELECT * FROM Dating").then(function(e){return t.fetchAll(e)})}function u(e){return t.query("SELECT * FROM Target WHERE id_user = ?",[e]).then(function(e){return t.fetch(e)})}var s={synchronizeDating:n,synchronizeTargets:o,setDating:r,setTarget:a,getDatings:i,getDailyBase:u};return s}angular.module("brfPhoneGapApp").factory("Dashboard",e),e.$inject=["$http","Database"]}(),function(){"use strict";function e(e,t){var n=this;return n.db=null,n.init=function(){n.db=window.openDatabase(t.DB_CONFIG.name,"1.0","database",2e3),angular.forEach(t.DB_CONFIG.tables,function(e){var t=[];angular.forEach(e.columns,function(e){t.push(e.name+" "+e.type)});var o="CREATE TABLE IF NOT EXISTS "+e.name+" ("+t.join(",")+")";n.query(o),console.log("Table "+e.name+" initialized")})},n.dropAll=function(){var o=e.defer(),r=[];return angular.forEach(t.DB_CONFIG.tables,function(t){var a="DROP TABLE IF EXISTS "+t.name;r.push(n.query(a)),console.log("Table "+t.name+" has been drop"),e.all(r).then(function(){o.resolve()})}),o.promise},n.query=function(t,o){o="undefined"!=typeof o?o:[];var r=e.defer();return n.db.transaction(function(e){e.executeSql(t,o,function(e,t){r.resolve(t)},function(e,t){console.log("Database Error:"+t.message),r.reject(t)})}),r.promise},n.fetchAll=function(e){for(var t=[],n=0;n<e.rows.length;n++)t.push(e.rows.item(n));return t},n.fetch=function(e){return e.rows.item(0)},n}angular.module("brfPhoneGapApp").factory("Database",e),e.$inject=["$q","Config"]}(),function(){"use strict";function e(e){function t(){return e.get("https://ws.conecta-brf.com/get/images/?token=560a100abad225d5afdf4fc6e5334917")}var n={getAllImages:t};return n}angular.module("brfPhoneGapApp").factory("Image",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var n=this;return n.validateUser=function(t,n){return e.get("https://ws.conecta-brf.com/validate/user/?token=560a100abad225d5afdf4fc6e5334917&email="+t+"&pass="+n)},n.authenticated=function(){return void 0!=BrfNameSpace.Session.getInstance().get()},n.authenticate=function(e){BrfNameSpace.Session.getInstance().set(e)},n.getToken=function(e){return BrfNameSpace.Session.getInstance().get()},n}angular.module("brfPhoneGapApp").factory("Login",e),e.$inject=["$http","Database"]}(),function(){"use strict";function e(e,t){var n=this;return n.synchronizeModules=function(){return e.get("https://ws.conecta-brf.com/get/modules/?token=560a100abad225d5afdf4fc6e5334917")},n.synchronizeMainModules=function(){return e.get("https://ws.conecta-brf.com/get/modules/main/?token=560a100abad225d5afdf4fc6e5334917")},n.setMainModule=function(e,n,o,r,a){t.query("INSERT INTO MainModule(id, mod_name, icon, map_label, has_dashboard) VALUES (?, ?, ?, ?, ?)",[e,n,o,r,a]).then(function(e){return!0})},n.setModule=function(e,n,o,r,a,i,u,s){t.query("INSERT INTO Module(moduleId, behavior, modName, categoryType, color, icon, slug, idMainMod) VALUES(?, ?, ?, ?, ?, ?, ?, ?)",[e,n,o,r,a,i,u,s]).then(function(e){return!0})},n.setModuleChannels=function(e,n){t.query("INSERT INTO ModuleChannels(moduleId, channelId) VALUES(?, ?)",[e,n]).then(function(e){return!0})},n.setModuleRoles=function(e,n){t.query("INSERT INTO ModuleUserRoles(moduleId, roleId) VALUES(?, ?)",[e,n]).then(function(e){return!0})},n.getModuleByName=function(e){return t.query("SELECT id, moduleId, behavior, modName, categoryType, color, icon FROM Module WHERE modName = ?",[e]).then(function(e){return t.fetch(e)})},n.getModuleBySlug=function(e){return t.query("SELECT id, moduleId, behavior, modName, categoryType, color, icon, slug FROM Module WHERE slug = ?",[e]).then(function(e){return t.fetch(e)})},n.getModules=function(e,n,o){var r="SELECT DISTINCT mod.id, mod.moduleId, mod.behavior, mod.modName, mod.categoryType, mod.color, mod.icon, mod.slug FROM Module mod INNER JOIN ModuleChannels modcha ON modcha.moduleId = mod.moduleId INNER JOIN ModuleUserRoles modur ON modur.moduleId = mod.moduleId WHERE modcha.channelId = ? AND modur.roleId = ? AND mod.idMainMod = ?";return t.query(r,[e,n,o]).then(function(e){return t.fetchAll(e)})},n.getDefaultModules=function(e,n){var o="SELECT DISTINCT mod.id, mod.moduleId, mod.behavior, mod.modName, mod.categoryType, mod.color, mod.icon, mod.slug FROM Module mod INNER JOIN ModuleChannels modcha ON modcha.moduleId = mod.moduleId INNER JOIN ModuleUserRoles modur ON modur.moduleId = mod.moduleId WHERE modcha.channelId = ? AND modur.roleId = ? LIMIT 0,1";return t.query(o,[e,n]).then(function(e){return t.fetch(e)})},n.getModuleById=function(e){return t.query("SELECT * FROM Module WHERE moduleId = ?",[e]).then(function(e){return t.fetch(e)})},n.getMainModules=function(){return t.query("SELECT * FROM MainModule").then(function(e){return t.fetchAll(e)})},n}angular.module("brfPhoneGapApp").factory("Module",e),e.$inject=["$http","Database"]}(),function(){"use strict";function e(e,t){var n=this;return n.synchronizeQuestions=function(){return e.get("https://ws.conecta-brf.com/get/questions/?token=560a100abad225d5afdf4fc6e5334917")},n.setQuestion=function(e){return t.query("INSERT INTO Question(questionId, categoryId, render, answer, title, data, helper, big, thumb, questionModuleId, config, styling, is_mandatory, has_percent, is_dashboard, weight, is_coaching) VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[e.questionId,e.categoryId,e.render,e.answer,e.title,e.data,e.helper,e.big,e.thumb,e.questionModuleId,e.config,e.styling,e.is_mandatory,e.has_percent,e.is_dashboard,e.weight,e.is_coaching]).then(function(e){return!0})},n.setQuestionPdv=function(e,n){return t.query("INSERT INTO QuestionPdv(questionId, pdvId) VALUES(?, ?)",[e,n]).then(function(e){return!0})},n.getQuestions=function(e,n,o,r){var a;return a=0===r?"SELECT q.questionId, q.render, q.answer, q.title, q.data, q.helper, q.config, q.styling, q.is_mandatory, q.has_percent, q.is_dashboard, q.weight, q.is_coaching,res.JSONData, q.thumb, q.big FROM Question q LEFT JOIN SurveyQuestionsResults res ON res.questionId = q.questionId AND res.surveyId = ? INNER JOIN Module mod ON mod.moduleId = q.questionModuleId WHERE q.questionModuleId = ?":"SELECT q.questionId, q.render, q.answer, q.title, q.data, q.helper, q.config, q.styling, q.is_mandatory, q.has_percent, q.is_dashboard, q.weight, q.is_coaching,res.JSONData, q.thumb, q.big FROM Question q LEFT JOIN SurveyQuestionsResults res ON res.questionId = q.questionId AND res.surveyId = ? INNER JOIN Module mod ON mod.moduleId = q.questionModuleId INNER JOIN Category cat ON cat.categoryId = q.categoryId AND cat.type = mod.categoryType WHERE q.questionModuleId = ?",void 0!==o&&null!==o&&0!=o&&(a=a+" AND q.categoryId = "+o),t.query(a,[n,e]).then(function(e){for(var t=[],n=function(e,t){var n;if(null===e)switch(t){case"binary":n={};break;case"open":n={value:""};break;case"price":n={value:""};break;case"multiple":n=[]}else"multiple"!==t&&(n=JSON.parse(e));return n},o=function(e,t,n){return null===e?n:"multiple"!==t?n:(n.answer_config.selected=JSON.parse(e),n)},r=0;r<e.rows.length;r++)t.push({id:e.rows.item(r).questionId,render:e.rows.item(r).render,answer:e.rows.item(r).answer,title:e.rows.item(r).title,data:e.rows.item(r).data,helper:e.rows.item(r).helper,config:o(e.rows.item(r).JSONData,e.rows.item(r).answer,JSON.parse(e.rows.item(r).config)),styling:JSON.parse(e.rows.item(r).styling),is_mandatory:e.rows.item(r).helper,has_percent:e.rows.item(r).has_percent,is_dashboard:e.rows.item(r).is_dashboard,weight:e.rows.item(r).weight,is_coaching:e.rows.item(r).is_coaching,JSONData:n(e.rows.item(r).JSONData,e.rows.item(r).answer),big:e.rows.item(r).big,thumb:e.rows.item(r).thumb});return t})},n.getQuestionsBySurveyId=function(e){return t.query("SELECT questionId AS [id], JSONData AS [value] FROM SurveyQuestionsResults WHERE surveyId = ?",[e]).then(function(e){var n=t.fetchAll(e),o=new Array;return angular.forEach(n,function(e,t){o.push({id:e.id,value:JSON.parse(e.value)})}),o})},n.getCoachingQuestionsPerUserRolesCount=function(e){var n="  SELECT DISTINCT q.questionId FROM Question q  INNER JOIN Module mod ON q.questionModuleId = mod.moduleId  INNER JOIN ModuleUserRoles modRol ON modRol.moduleId = mod.moduleId  WHERE modRol.roleId = ?  AND q.is_coaching = 1";return t.query(n,[e]).then(function(e){return e.rows.length})},n.getBaseWeightPerModule=function(e,n,o){var r="SELECT SUM(q2.weight) [base], q2.questionModuleId AS [moduleId], mod2.modName, mod2.icon FROM Question q2 INNER JOIN SurveyQuestionsResults res ON res.questionId = q2.questionId INNER JOIN Module mod2 ON mod2.moduleId = q2.questionModuleId INNER JOIN MainModule main ON main.id = mod2.idMainMod WHERE q2.questionId IN ( SELECT q.questionId FROM Question q  INNER JOIN ModuleChannels modChan ON modChan.moduleId = q.questionModuleId INNER JOIN ModuleUserRoles modRol ON modRol.moduleId = q.questionModuleId WHERE modChan.channelId = ? AND modRol.roleId = ?) AND q2.questionModuleId IN (SELECT DISTINCT q3.questionModuleId FROM Question q3 INNER JOIN SurveyQuestionsResults surres ON q3.questionId = surres.questionId) AND main.has_dashboard = 1 AND res.surveyId = ? GROUP BY q2.questionModuleId";return t.query(r,[n,e,o]).then(function(e){return t.fetchAll(e)})},n.getModulePercentageByWeight=function(e,n,o){var r=" SELECT  ((SELECT SUM(q.weight) FROM Question q    INNER JOIN SurveyQuestionsResults res ON q.questionId = res.questionId    AND res.surveyId = ? WHERE res.JSONData LIKE '%true%' AND q.questionModuleId = ?) / ?) * 100 [ModulePercentage]";return t.query(r,[e,n,o]).then(function(e){return t.fetch(e)})},n.getCalcultedTotalWeight=function(e){var n=" SELECT mod.icon, mod.modName, mod.moduleId, SUM((q.weight * (100 / ?)) * CASE WHEN sqr.JSONData LIKE '%true%' THEN 1 ELSE 0 END) AS [finalValue] FROM Question q INNER JOIN SurveyQuestionsResults sqr ON q.questionId = sqr.questionId INNER JOIN Module mod ON q.questionModuleId = mod.moduleId WHERE q.is_dashboard = 1 GROUP BY mod.icon, mod.modName, mod.moduleId";return t.query(n,[e]).then(function(e){return t.fetchAll(e)})},n.getAuditedQuestionsResume=function(e,n){var o="SELECT ROUND(AVG( ( SELECT ROUND(COUNT(*), 2) FROM SurveyQuestionsResults  res1 WHERE res1.JSONData LIKE '%true%' AND res1.questionid = res0.questionId ) / ( SELECT ROUND(COUNT(*), 2)  FROM SurveyQuestionsResults  res1 WHERE res1.questionid = res0.questionId)) * 100, 2) AS [questionAverage], q.title FROM SurveyQuestionsResults  res0 INNER JOIN Survey sur ON sur.id = res0.surveyId INNER JOIN Question q ON q.questionId = res0.questionId INNER JOIN Module mod ON mod.moduleId = q.questionModuleId AND q.questionModuleId = ? AND mod.idMainMod = ? GROUP BY q.title";return t.query(o,[e,n]).then(function(e){return t.fetchAll(e)})},n.getQuestionById=function(e){return t.query("SELECT * FROM Question q WHERE q.questionId = ?",[e]).then(function(e){return t.fetch(e)})},n.getMandatoryQuestions=function(e,n,o,r){return t.query("SELECT q.*, mod.slug FROM Question q INNER JOIN Module mod ON mod.moduleId = q.questionModuleId INNER JOIN ModuleUserRoles modUs ON q.questionModuleId = modUs.moduleId INNER JOIN ModuleChannels modCh ON modCh.moduleId = modUs.moduleId LEFT JOIN SurveyQuestionsResults qRes ON qRes.questionId = q.questionId  AND qRes.surveyId = ?  WHERE q.is_mandatory = 2  AND modUs.roleId = ?  AND modCh.channelId = ? AND qRes.questionId IS NULL AND mod.idMainMod = ?",[e,n,o,r]).then(function(e){return t.fetchAll(e)})},n.getSuggestedQuestions=function(e,n,o,r){return t.query("SELECT q.*, mod.slug FROM Question q INNER JOIN Module mod ON mod.moduleId = q.questionModuleId INNER JOIN ModuleUserRoles modUs ON q.questionModuleId = modUs.moduleId INNER JOIN ModuleChannels modCh ON modCh.moduleId = modUs.moduleId LEFT JOIN SurveyQuestionsResults qRes ON qRes.questionId = q.questionId  AND qRes.surveyId = ?  WHERE q.is_mandatory = 1  AND modUs.roleId = ?  AND modCh.channelId = ? AND qRes.questionId IS NULL AND mod.idMainMod = ?",[e,n,o,r]).then(function(e){return t.fetchAll(e)})},n}angular.module("brfPhoneGapApp").factory("Question",e),e.$inject=["$http","Database"]}(),function(){"use strict";function e(e,t){var n=this;return n.synchronizeSellers=function(){return e.get("https://ws.conecta-brf.com/get/sellers/?token=560a100abad225d5afdf4fc6e5334917")},n.setSeller=function(e,n){return t.query("INSERT INTO Seller(id, name) VALUES(?, ?)",[e,n]).then(function(e){return!0})},n.getSellers=function(){return t.query("SELECT id, name FROM Seller").then(function(e){return t.fetchAll(e)})},n.setChoosenPdv=function(e){window.localStorage.setItem(pdvKeyId,e)},n}angular.module("brfPhoneGapApp").factory("Seller",e),e.$inject=["$http","Database"]}();var auditModeKey="audit-mode",channelKeyId="channel-id",pdvKeyId="pdv-id",sellerKeyId="seller-id",lastChannelKeyId="last-channel-id",lastSellerKeyId="last-seller-id",lastPdvKeyId="last-pdv-id",auditIdKey="audit-id";!function(){"use strict";function e(e,t,n,o,r,a){var i=this;return i.setSurvey=function(e,n,o,r,a){return console.log("setSurvey"),t.query("INSERT INTO Survey(survey, syncStatus, channelId, pdvId, sellerId, userId, date, coaching_compliance) VALUES (?, ?, ?, ?, ?, ?, datetime(), 0)",[e,0,n,o,r,a]).then(function(e){return!0})},i.getPendingSurvey=function(){return t.query("SELECT id, survey, syncStatus FROM Survey WHERE syncStatus = 0 LIMIT 0,1").then(function(e){return e.rows.length>0?t.fetch(e):void 0})},i.updateSurveyStatus=function(e){return t.query("UPDATE Survey SET syncStatus = 1, coaching_compliance = ? WHERE syncStatus = 0",[e]).then(function(){return!0})},i.enableAuditMode=function(e,t,n,o){window.localStorage.setItem(auditModeKey,!0),window.localStorage.setItem(channelKeyId,e),window.localStorage.setItem(pdvKeyId,t),window.localStorage.setItem(sellerKeyId,n),window.localStorage.setItem(lastChannelKeyId,e),window.localStorage.setItem(lastSellerKeyId,n),window.localStorage.setItem(lastPdvKeyId,t),window.localStorage.setItem(auditIdKey,o)},i.disableAuditMode=function(){window.localStorage.setItem(auditModeKey,!1),window.localStorage.setItem(channelKeyId,0),window.localStorage.setItem(pdvKeyId,0),window.localStorage.setItem(sellerKeyId,0),window.localStorage.setItem(auditIdKey,0)},i.getAuditId=function(){return void 0===window.localStorage.getItem(auditIdKey)&&window.localStorage.setItem(auditIdKey,0),window.localStorage.getItem(auditIdKey)},i.getAuditMode=function(){return void 0===window.localStorage.getItem(auditModeKey)&&window.localStorage.setItem(auditModeKey,!1),"true"===window.localStorage.getItem(auditModeKey)},i.getAuditChannel=function(){return void 0===window.localStorage.getItem(channelKeyId)&&window.localStorage.setItem(channelKeyId,0),window.localStorage.getItem(channelKeyId)},i.getLastAuditChannel=function(){return window.localStorage.getItem(lastChannelKeyId)},i.getAuditPdv=function(){return void 0===window.localStorage.getItem(pdvKeyId)&&window.localStorage.setItem(pdvKeyId,0),window.localStorage.getItem(pdvKeyId)},i.getLastAuditPdv=function(){return window.localStorage.getItem(lastPdvKeyId)},i.getAuditSeller=function(){return void 0===window.localStorage.getItem(sellerKeyId)&&window.localStorage.setItem(sellerKeyId,0),window.localStorage.getItem(sellerKeyId)},i.getLastAuditSeller=function(){return window.localStorage.getItem(lastSellerKeyId)},i.setQuestionAnswer=function(e,n,o){return t.query("UPDATE SurveyQuestionsResults SET JSONData = ? WHERE questionId = ? AND surveyId = ?",[o,n,e]).then(function(r){return 0===r.rowsAffected?t.query("INSERT INTO SurveyQuestionsResults(surveyId, questionId, JSONData) VALUES (?, ?, ?)",[e,n,o]).then(function(e){return!0}):!0})},i.deleteQuestionAnswer=function(e,n){return t.query("DELETE FROM SurveyQuestionsResults WHERE questionId = ? AND surveyId = ?",[n,e]).then(function(e){return!0})},i.setNoBrf=function(e,n){return t.query("UPDATE SurveyNoBrfResults SET noBrf = ? WHERE surveyId = ?",[n,e]).then(function(o){return 0===o.rowsAffected?t.query("INSERT INTO SurveyNoBrfResults(surveyId, noBrf) VALUES(?, ?)",[e,n]).then(function(e){return!0}):!0})},i.setObservations=function(e,n){return t.query("UPDATE SurveyObservationResults SET observations = ? WHERE surveyId = ?",[n,e]).then(function(o){return 0===o.rowsAffected?t.query("INSERT INTO SurveyObservationResults(surveyId, observations) VALUES(?, ?)",[e,n]).then(function(e){return!0}):!0})},i.getNoBrf=function(e){return t.query("SELECT noBrf FROM SurveyNoBrfResults WHERE surveyId = ?",[e]).then(function(e){return e.rows.length>0?t.fetch(e):void 0})},i.getObservations=function(e){return t.query("SELECT observations FROM SurveyObservationResults WHERE surveyId = ?",[e]).then(function(e){return e.rows.length>0?t.fetch(e):void 0})},i.getClosedSurveys=function(){return t.query("SELECT survey, syncStatus, channelId, pdvId, sellerId, userId, id FROM Survey WHERE syncStatus = 1").then(function(e){return t.fetchAll(e)})},i.getClosedSurveysNoBrf=function(){return t.query("SELECT sur.survey, nobrf.noBrf, sur.userId FROM SurveyNoBrfResults nobrf INNER JOIN Survey sur ON sur.id = nobrf.surveyId WHERE sur.syncStatus = 1").then(function(e){return t.fetchAll(e)})},i.informSurvey=function(t){var n={method:"POST",url:"https://ws.conecta-brf.com/set/survey/?token=560a100abad225d5afdf4fc6e5334917",headers:{"Content-Type":"application/json"},data:t};return e(n)},i.informNoBrfSurvey=function(t){console.log(t);var n={method:"POST",url:"https://ws.conecta-brf.com/set/survey/no-brf/?token=560a100abad225d5afdf4fc6e5334917",headers:{"Content-Type":"application/json"},data:t};return e(n)},i.informSurveyQuestions=function(t){var n={method:"POST",url:"https://ws.conecta-brf.com/set/survey/questions/?token=560a100abad225d5afdf4fc6e5334917",headers:{"Content-Type":"application/json"},data:t};return e(n)},i.getCoachingSurveyQuestionsCount=function(e){var n="SELECT q.* FROM Question q INNER JOIN SurveyQuestionsResults sq ON sq.questionId = q.questionId WHERE sq.surveyId = ? AND q.is_coaching = 1";return t.query(n,[e]).then(function(e){return e.rows.length})},i.getVisitedCoachingPdvsCount=function(e){return t.query("SELECT * FROM Survey WHERE userId = ? AND coaching_compliance = 1",[e]).then(function(e){return e.rows.length})},i.setAuditFinalValues=function(e,n,o,r,a,i){return t.query("INSERT INTO AuditFinalValues(id_audit, id_mod, mod_name, final_value, icon, id_mainmod) VALUES (?, ?, ?, ?, ?, ?)",[e,n,o,r,a,i]).then(function(){return!0})},i.getAuditFinalValues=function(){return t.query("SELECT * from AuditFinalValues").then(function(e){return t.fetchAll(e)})},i.getAveragePerModule=function(e){var n="SELECT ROUND(AVG(afr.final_value), 2) [moduleAverage], afr.id_mod, mod.modName [moduleName], mod.icon FROM AuditFinalValues afr INNER JOIN Module mod ON mod.moduleId = afr.id_mod WHERE afr.id_mainmod = ? GROUP BY afr.id_mod HAVING moduleAverage IS NOT NULL";return t.query(n,[e]).then(function(e){return t.fetchAll(e)})},i.closeSurvey=function(e,t,u,s){var d=function(e,t,n){i.updateSurveyStatus(e).then(function(){r.$emit("closedSurvey"),n?o.path("/Dashboard/"+t):o.path("/Main")})};i.disableAuditMode(),a.all([n.getCoachingQuestionsPerUserRolesCount(e),i.getCoachingSurveyQuestionsCount(u),n.getBaseWeightPerModule(e,t,u)]).then(function(e){var t=e[0],o=e[1],r=e[2],c=0;t===o&&(c=1),r.length>0?angular.forEach(r,function(e,t){var o=[];n.getModulePercentageByWeight(u,e.moduleId,e.base).then(function(t){o.push(i.setAuditFinalValues(u,e.moduleId,e.modName,null===t.ModulePercentage?0:t.ModulePercentage,e.icon,s))}),a.all(o).then(function(){d(c,s,!0)})}):d(c,s,!1)})},i.getCoachingComplianceSurvey=function(){return t.query("SELECT * FROM Survey WHERE coaching_compliance = 1").then(function(e){return t.fetchAll(e)})},i}angular.module("brfPhoneGapApp").factory("Survey",e),e.$inject=["$http","Database","Question","$location","$rootScope","$q"]}(),function(){"use strict";function e(e){var t=this;return t.getTargetCoaching=function(){return e.query("SELECT target_coaching FROM Target").then(function(t){return e.fetch(t)})},t}angular.module("brfPhoneGapApp").service("Target",e),e.$inject=["Database"]}();var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){app.receivedEvent("deviceready")},receivedEvent:function(e){var t=document.getElementById(e),n=t.querySelector(".listening"),o=t.querySelector(".received");n.setAttribute("style","display:none;"),o.setAttribute("style","display:block;"),console.log("Received Event: "+e)}},BrfNameSpace=BrfNameSpace||{};BrfNameSpace.Session=function(){function e(){var e="brf-session";return{set:function(t){window.localStorage.setItem(e,JSON.stringify(t))},get:function(){var t=null;try{t=JSON.parse(window.localStorage.getItem(e))}catch(n){}return t}}}var t;return{getInstance:function(){return t||(t=e()),t}}}();